"use strict";(globalThis.webpackChunkfull_it_infra_design_docs=globalThis.webpackChunkfull_it_infra_design_docs||[]).push([[2354],{1219(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>p,frontMatter:()=>c,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"architecture/training-data-backup/deployment","title":"\u90e8\u7f72\u4e0e\u8c03\u4f18\u6307\u5357","description":"\u4e3a\u4e86\u8fbe\u5230 10Gbps+ \u7684\u4f20\u8f93\u901f\u5ea6\uff0c\u4ec5\u4ec5\u9009\u62e9\u6b63\u786e\u7684\u8f6f\u4ef6\u662f\u4e0d\u591f\u7684\uff0c\u8fd8\u9700\u8981\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f51\u7edc\u6808\u8fdb\u884c\u8c03\u4f18\u3002","source":"@site/docs/03-architecture/training-data-backup/deployment.md","sourceDirName":"03-architecture/training-data-backup","slug":"/architecture/training-data-backup/deployment","permalink":"/full-it-infra-design-docs/docs/architecture/training-data-backup/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-architecture/training-data-backup/deployment.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Tsunami UDP (\u6781\u901f\u65b9\u6848)","permalink":"/full-it-infra-design-docs/docs/architecture/training-data-backup/tsunami-udp"},"next":{"title":"bbcp (TCP\u9ad8\u901f\u65b9\u6848)","permalink":"/full-it-infra-design-docs/docs/architecture/training-data-backup/bbcp"}}');var s=t(4848),i=t(8453);const c={sidebar_position:5},r="\u90e8\u7f72\u4e0e\u8c03\u4f18\u6307\u5357",o={},d=[{value:"1. \u7cfb\u7edf\u53c2\u6570\u8c03\u4f18 (Sysctl)",id:"1-\u7cfb\u7edf\u53c2\u6570\u8c03\u4f18-sysctl",level:2},{value:"2. \u7f51\u5361\u5de8\u578b\u5e27 (Jumbo Frame)",id:"2-\u7f51\u5361\u5de8\u578b\u5e27-jumbo-frame",level:2},{value:"3. SSH \u514d\u5bc6\u767b\u5f55\u914d\u7f6e (bbcp \u7528)",id:"3-ssh-\u514d\u5bc6\u767b\u5f55\u914d\u7f6e-bbcp-\u7528",level:2},{value:"4. \u81ea\u52a8\u5316\u5b9a\u65f6\u4efb\u52a1",id:"4-\u81ea\u52a8\u5316\u5b9a\u65f6\u4efb\u52a1",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u90e8\u7f72\u4e0e\u8c03\u4f18\u6307\u5357",children:"\u90e8\u7f72\u4e0e\u8c03\u4f18\u6307\u5357"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e3a\u4e86\u8fbe\u5230 10Gbps+ \u7684\u4f20\u8f93\u901f\u5ea6\uff0c\u4ec5\u4ec5\u9009\u62e9\u6b63\u786e\u7684\u8f6f\u4ef6\u662f\u4e0d\u591f\u7684\uff0c\u8fd8\u9700\u8981\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f51\u7edc\u6808\u8fdb\u884c\u8c03\u4f18\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"1-\u7cfb\u7edf\u53c2\u6570\u8c03\u4f18-sysctl",children:"1. \u7cfb\u7edf\u53c2\u6570\u8c03\u4f18 (Sysctl)"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u6240\u6709\u8282\u70b9\uff08\u670d\u52a1\u5668\u548c\u9ad8\u6027\u80fd\u5ba2\u6237\u7aef\uff09\u4e0a\u5e94\u7528\u4ee5\u4e0b\u914d\u7f6e\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# /etc/sysctl.conf\n\n# \u7f51\u7edc\u7f13\u51b2\u533a\u8c03\u4f18 - \u5141\u8bb8\u66f4\u5927\u7684 TCP \u7a97\u53e3\nnet.core.rmem_max = 536870912\nnet.core.wmem_max = 536870912\nnet.core.rmem_default = 1048576\nnet.core.wmem_default = 1048576\nnet.ipv4.tcp_rmem = 4096 87380 536870912\nnet.ipv4.tcp_wmem = 4096 65536 536870912\n\n# \u542f\u7528 TCP \u7a97\u53e3\u6269\u5927\u56e0\u5b50 (Window Scaling)\nnet.ipv4.tcp_window_scaling = 1\n\n# \u7981\u7528 TCP \u5ef6\u8fdf\u786e\u8ba4 (\u964d\u4f4e\u5ef6\u8fdf)\nnet.ipv4.tcp_no_metrics_save = 1\nnet.ipv4.tcp_low_latency = 1\n\n# UDP \u7f13\u51b2\u533a (Namida/Tsunami \u9700\u8981)\nnet.core.netdev_max_backlog = 50000\n\n# \u5e94\u7528\u914d\u7f6e\nsudo sysctl -p\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u540c\u65f6\u4fee\u6539 Limits \u914d\u7f6e\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# /etc/security/limits.conf\n*    soft    nofile    1000000\n*    hard    nofile    1000000\n*    soft    memlock    unlimited\n*    hard    memlock    unlimited\n"})}),"\n",(0,s.jsx)(n.h2,{id:"2-\u7f51\u5361\u5de8\u578b\u5e27-jumbo-frame",children:"2. \u7f51\u5361\u5de8\u578b\u5e27 (Jumbo Frame)"}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u4ea4\u6362\u673a\u652f\u6301\uff0c\u5f00\u542f Jumbo Frame (MTU 9000) \u53ef\u4ee5\u663e\u8457\u964d\u4f4e CPU \u8d1f\u8f7d\u5e76\u63d0\u5347\u541e\u5410\u91cf\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u4e34\u65f6\u8bbe\u7f6e\nsudo ip link set eth0 mtu 9000\n\n# \u6301\u4e45\u5316\u914d\u7f6e (/etc/network/interfaces)\nauto eth0\niface eth0 inet static\n  ...\n  mtu 9000\n"})}),"\n",(0,s.jsx)(n.h2,{id:"3-ssh-\u514d\u5bc6\u767b\u5f55\u914d\u7f6e-bbcp-\u7528",children:"3. SSH \u514d\u5bc6\u767b\u5f55\u914d\u7f6e (bbcp \u7528)"}),"\n",(0,s.jsx)(n.p,{children:"bbcp \u4f9d\u8d56 SSH \u8fdb\u884c\u63a7\u5236\u4fe1\u9053\u901a\u4fe1\u3002\u63a8\u8350\u914d\u7f6e\u4e13\u7528\u7684\u3001\u65e0\u52a0\u5bc6\u7684 SSH \u901a\u9053\u4ee5\u63d0\u5347\u901f\u5ea6\uff08\u4ec5\u9650\u5185\u7f51\uff09\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# 1. \u751f\u6210\u4e13\u7528\u5bc6\u94a5\nssh-keygen -t ed25519 -f ~/.ssh/id_bbcp -N ""\n\n# 2. \u914d\u7f6e SSH \u5ba2\u6237\u7aef (~/.ssh/config)\nHost nas\n    HostName 192.168.1.100\n    User backup\n    IdentityFile ~/.ssh/id_bbcp\n    # \u5173\u952e\uff1a\u7981\u7528\u52a0\u5bc6\u7b97\u6cd5\n    Ciphers none\n    MACs none\n    Compression no\n    BatchMode yes\n    StrictHostKeyChecking no\n\n# 3. \u5206\u53d1\u516c\u94a5\nssh-copy-id -i ~/.ssh/id_bbcp.pub backup@192.168.1.100\n'})}),"\n",(0,s.jsx)(n.h2,{id:"4-\u81ea\u52a8\u5316\u5b9a\u65f6\u4efb\u52a1",children:"4. \u81ea\u52a8\u5316\u5b9a\u65f6\u4efb\u52a1"}),"\n",(0,s.jsx)(n.p,{children:"\u63a8\u8350\u4f7f\u7528 Systemd Timer \u66ff\u4ee3 Crontab\uff0c\u4ee5\u4fbf\u66f4\u597d\u5730\u7ba1\u7406\u65e5\u5fd7\u548c\u4f9d\u8d56\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"# ~/.config/systemd/user/backup-bbcp.service\n[Unit]\nDescription=\u8bad\u7ec3\u6570\u636e\u5907\u4efd (bbcp\u6781\u901f\u7248)\nAfter=network-online.target\n\n[Service]\nType=oneshot\nExecStart=%h/scripts/backup-bbcp-fast.sh\nStandardOutput=append:%h/.local/share/backup/logs/backup.log\nStandardError=append:%h/.local/share/backup/logs/backup.error.log\n\n[Install]\nWantedBy=default.target\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"# ~/.config/systemd/user/backup-bbcp.timer\n[Unit]\nDescription=\u6bcf\u592922:00\u81ea\u52a8\u5907\u4efd\u8bad\u7ec3\u6570\u636e\n\n[Timer]\nOnCalendar=*-*-* 22:00:00\nPersistent=true\nRandomizedDelaySec=5min\n\n[Install]\nWantedBy=timers.target\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453(e,n,t){t.d(n,{R:()=>c,x:()=>r});var a=t(6540);const s={},i=a.createContext(s);function c(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);