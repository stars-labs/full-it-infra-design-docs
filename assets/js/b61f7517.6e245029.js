"use strict";(globalThis.webpackChunkfull_it_infra_design_docs=globalThis.webpackChunkfull_it_infra_design_docs||[]).push([[6434],{3086(n,e,s){s.r(e),s.d(e,{assets:()=>t,contentTitle:()=>l,default:()=>x,frontMatter:()=>r,metadata:()=>d,toc:()=>h});const d=JSON.parse('{"id":"training-data-backup","title":"\u8bad\u7ec3\u6570\u636e\u5907\u4efd\u65b9\u6848 - \u4f20\u8f93\u6280\u672f\u5bf9\u6bd4","description":"\u4f20\u8f93\u6280\u672f\u5bf9\u6bd4","source":"@site/docs/training-data-backup.md","sourceDirName":".","slug":"/training-data-backup","permalink":"/full-it-infra-design-docs/docs/training-data-backup","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/training-data-backup.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"\u673a\u623f\u57fa\u7840\u8bbe\u65bd\u8bbe\u8ba1","permalink":"/full-it-infra-design-docs/docs/datacenter-infra"}}');var c=s(4848),i=s(8453);const r={sidebar_position:9},l="\u8bad\u7ec3\u6570\u636e\u5907\u4efd\u65b9\u6848 - \u4f20\u8f93\u6280\u672f\u5bf9\u6bd4",t={},h=[{value:"\u4f20\u8f93\u6280\u672f\u5bf9\u6bd4",id:"\u4f20\u8f93\u6280\u672f\u5bf9\u6bd4",level:2},{value:"\u4e3b\u6d41\u6280\u672f\u5bf9\u6bd4\u8868\uff08\u901f\u5ea6\u4f18\u5148\uff09",id:"\u4e3b\u6d41\u6280\u672f\u5bf9\u6bd4\u8868\u901f\u5ea6\u4f18\u5148",level:3},{value:"\u901f\u5ea6\u5b9e\u6d4b\u5bf9\u6bd4\uff0810Gbps\u5c40\u57df\u7f51\uff09",id:"\u901f\u5ea6\u5b9e\u6d4b\u5bf9\u6bd410gbps\u5c40\u57df\u7f51",level:3},{value:"\u901f\u5ea6\u4f18\u5148\u63a8\u8350\u65b9\u6848\uff1abbcp",id:"\u901f\u5ea6\u4f18\u5148\u63a8\u8350\u65b9\u6848bbcp",level:2},{value:"\u901f\u5ea6\u5bf9\u6bd4\uff0810Gbps\u5c40\u57df\u7f51\uff09",id:"\u901f\u5ea6\u5bf9\u6bd410gbps\u5c40\u57df\u7f51",level:3},{value:"bbcp \u4f18\u52bf\uff08\u901f\u5ea6\u4f18\u5148\uff09",id:"bbcp-\u4f18\u52bf\u901f\u5ea6\u4f18\u5148",level:3},{value:"bbcp \u5b89\u88c5",id:"bbcp-\u5b89\u88c5",level:3},{value:"bbcp \u9ad8\u901f\u4f20\u8f93\uff08\u65e0\u52a0\u5bc6\uff09",id:"bbcp-\u9ad8\u901f\u4f20\u8f93\u65e0\u52a0\u5bc6",level:3},{value:"bbcp \u5b8c\u6574\u9ad8\u901f\u811a\u672c",id:"bbcp-\u5b8c\u6574\u9ad8\u901f\u811a\u672c",level:3},{value:"bbcp \u591a\u6587\u4ef6\u5e76\u884c\u4f20\u8f93",id:"bbcp-\u591a\u6587\u4ef6\u5e76\u884c\u4f20\u8f93",level:3},{value:"Systemd Timer\u914d\u7f6e\uff08bbcp\u6781\u901f\u7248\uff09",id:"systemd-timer\u914d\u7f6ebbcp\u6781\u901f\u7248",level:3},{value:"GridFTP \u6781\u901f\u914d\u7f6e\uff08\u53ef\u9009\uff09",id:"gridftp-\u6781\u901f\u914d\u7f6e\u53ef\u9009",level:3},{value:"bbcp \u4f18\u52bf\uff08\u901f\u5ea6\u4f18\u5148\uff09",id:"bbcp-\u4f18\u52bf\u901f\u5ea6\u4f18\u5148-1",level:3},{value:"bbcp \u5b89\u88c5",id:"bbcp-\u5b89\u88c5-1",level:3},{value:"bbcp \u4f7f\u7528",id:"bbcp-\u4f7f\u7528",level:3},{value:"bbcp \u5b8c\u6574\u811a\u672c",id:"bbcp-\u5b8c\u6574\u811a\u672c",level:3},{value:"\u901f\u5ea6\u4f18\u5316\u53c2\u6570\u5bf9\u6bd4",id:"\u901f\u5ea6\u4f18\u5316\u53c2\u6570\u5bf9\u6bd4",level:2},{value:"\u4e0d\u540c\u7f51\u7edc\u73af\u5883\u7684\u6700\u4f73\u9009\u62e9\uff08\u901f\u5ea6\u4f18\u5148\uff09",id:"\u4e0d\u540c\u7f51\u7edc\u73af\u5883\u7684\u6700\u4f73\u9009\u62e9\u901f\u5ea6\u4f18\u5148",level:3},{value:"\u53c2\u6570\u8c03\u4f18\u5efa\u8bae\uff08\u901f\u5ea6\u4f18\u5148\uff09",id:"\u53c2\u6570\u8c03\u4f18\u5efa\u8bae\u901f\u5ea6\u4f18\u5148",level:3},{value:"\u8fb9\u4f20\u8fb9\u5220\u7b56\u7565",id:"\u8fb9\u4f20\u8fb9\u5220\u7b56\u7565",level:2},{value:"\u65b9\u6848\u5bf9\u6bd4",id:"\u65b9\u6848\u5bf9\u6bd4",level:3},{value:"\u63a8\u8350\u7b56\u7565",id:"\u63a8\u8350\u7b56\u7565",level:3},{value:"\u65b9\u6848\u9009\u62e9\u5efa\u8bae\uff08\u901f\u5ea6\u4f18\u5148\uff09",id:"\u65b9\u6848\u9009\u62e9\u5efa\u8bae\u901f\u5ea6\u4f18\u5148",level:2},{value:"\u6700\u7ec8\u63a8\u8350\u914d\u7f6e\uff08\u901f\u5ea6\u4f18\u5148\uff09",id:"\u6700\u7ec8\u63a8\u8350\u914d\u7f6e\u901f\u5ea6\u4f18\u5148",level:3},{value:"UDP\u6781\u901f\u65b9\u6848\uff1aTsunami UDP Protocol",id:"udp\u6781\u901f\u65b9\u6848tsunami-udp-protocol",level:2},{value:"\u4e3a\u4ec0\u4e48UDP\u5728\u597d\u7f51\u7edc\u4e0b\u66f4\u5feb\uff1f",id:"\u4e3a\u4ec0\u4e48udp\u5728\u597d\u7f51\u7edc\u4e0b\u66f4\u5feb",level:3},{value:"Tsunami UDP Protocol",id:"tsunami-udp-protocol",level:3},{value:"UDT (UDP-based Data Transfer)",id:"udt-udp-based-data-transfer",level:3},{value:"UDP\u65b9\u6848\u5bf9\u6bd4",id:"udp\u65b9\u6848\u5bf9\u6bd4",level:3},{value:"Tsunami \u5b8c\u6574\u811a\u672c",id:"tsunami-\u5b8c\u6574\u811a\u672c",level:3},{value:"UDP\u65b9\u6848\u4f7f\u7528\u5efa\u8bae",id:"udp\u65b9\u6848\u4f7f\u7528\u5efa\u8bae",level:3},{value:"\u7efc\u5408\u63a8\u8350\uff08\u901f\u5ea6\u4f18\u5148\uff09",id:"\u7efc\u5408\u63a8\u8350\u901f\u5ea6\u4f18\u5148",level:3},{value:"\u8be6\u7ec6\u90e8\u7f72\u843d\u5730\u65b9\u6848",id:"\u8be6\u7ec6\u90e8\u7f72\u843d\u5730\u65b9\u6848",level:2},{value:"\u4e00\u3001\u73af\u5883\u51c6\u5907",id:"\u4e00\u73af\u5883\u51c6\u5907",level:3},{value:"1.1 \u7f51\u7edc\u73af\u5883\u8981\u6c42",id:"11-\u7f51\u7edc\u73af\u5883\u8981\u6c42",level:4},{value:"1.2 \u7cfb\u7edf\u53c2\u6570\u4f18\u5316",id:"12-\u7cfb\u7edf\u53c2\u6570\u4f18\u5316",level:4},{value:"1.3 \u7f51\u5361Jumbo Frame\u914d\u7f6e",id:"13-\u7f51\u5361jumbo-frame\u914d\u7f6e",level:4},{value:"\u4e8c\u3001\u5b89\u88c5\u90e8\u7f72",id:"\u4e8c\u5b89\u88c5\u90e8\u7f72",level:3},{value:"2.1 bbcp \u5b89\u88c5\uff08\u6240\u6709\u8282\u70b9\uff09",id:"21-bbcp-\u5b89\u88c5\u6240\u6709\u8282\u70b9",level:4},{value:"2.2 Tsunami UDP \u5b89\u88c5\uff08\u6240\u6709\u8282\u70b9\uff09",id:"22-tsunami-udp-\u5b89\u88c5\u6240\u6709\u8282\u70b9",level:4},{value:"2.3 GridFTP \u5b89\u88c5\uff08NAS\u670d\u52a1\u5668\uff09",id:"23-gridftp-\u5b89\u88c5nas\u670d\u52a1\u5668",level:4},{value:"\u4e09\u3001\u914d\u7f6e\u90e8\u7f72",id:"\u4e09\u914d\u7f6e\u90e8\u7f72",level:3},{value:"3.1 SSH\u514d\u5bc6\u767b\u5f55\uff08bbcp\u7528\uff09",id:"31-ssh\u514d\u5bc6\u767b\u5f55bbcp\u7528",level:4},{value:"3.2 bbcp \u5b8c\u6574\u90e8\u7f72\u811a\u672c",id:"32-bbcp-\u5b8c\u6574\u90e8\u7f72\u811a\u672c",level:4},{value:"3.3 Tsunami UDP \u90e8\u7f72\u811a\u672c",id:"33-tsunami-udp-\u90e8\u7f72\u811a\u672c",level:4},{value:"\u56db\u3001Systemd \u670d\u52a1\u914d\u7f6e",id:"\u56dbsystemd-\u670d\u52a1\u914d\u7f6e",level:3},{value:"4.1 bbcp \u5b9a\u65f6\u5907\u4efd\u670d\u52a1",id:"41-bbcp-\u5b9a\u65f6\u5907\u4efd\u670d\u52a1",level:4},{value:"4.2 Tsunami UDP \u63a5\u6536\u7aef\u5e38\u9a7b\u670d\u52a1",id:"42-tsunami-udp-\u63a5\u6536\u7aef\u5e38\u9a7b\u670d\u52a1",level:4},{value:"\u4e94\u3001\u5907\u4efd\u811a\u672c",id:"\u4e94\u5907\u4efd\u811a\u672c",level:3},{value:"5.1 bbcp \u5b8c\u6574\u5907\u4efd\u811a\u672c",id:"51-bbcp-\u5b8c\u6574\u5907\u4efd\u811a\u672c",level:4},{value:"5.2 Tsunami UDP \u5907\u4efd\u811a\u672c",id:"52-tsunami-udp-\u5907\u4efd\u811a\u672c",level:4},{value:"\u516d\u3001\u76d1\u63a7\u4e0e\u544a\u8b66",id:"\u516d\u76d1\u63a7\u4e0e\u544a\u8b66",level:3},{value:"6.1 \u4f20\u8f93\u76d1\u63a7\u811a\u672c",id:"61-\u4f20\u8f93\u76d1\u63a7\u811a\u672c",level:4},{value:"6.2 Prometheus \u76d1\u63a7\u6307\u6807",id:"62-prometheus-\u76d1\u63a7\u6307\u6807",level:4},{value:"\u4e03\u3001\u6545\u969c\u6392\u67e5",id:"\u4e03\u6545\u969c\u6392\u67e5",level:3},{value:"7.1 \u5e38\u89c1\u95ee\u9898",id:"71-\u5e38\u89c1\u95ee\u9898",level:4},{value:"7.2 \u6027\u80fd\u8c03\u4f18\u68c0\u67e5\u6e05\u5355",id:"72-\u6027\u80fd\u8c03\u4f18\u68c0\u67e5\u6e05\u5355",level:4},{value:"\u516b\u3001\u90e8\u7f72\u68c0\u67e5\u6e05\u5355",id:"\u516b\u90e8\u7f72\u68c0\u67e5\u6e05\u5355",level:3},{value:"\u4e5d\u3001\u56de\u6eda\u65b9\u6848",id:"\u4e5d\u56de\u6eda\u65b9\u6848",level:3}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.header,{children:(0,c.jsx)(e.h1,{id:"\u8bad\u7ec3\u6570\u636e\u5907\u4efd\u65b9\u6848---\u4f20\u8f93\u6280\u672f\u5bf9\u6bd4",children:"\u8bad\u7ec3\u6570\u636e\u5907\u4efd\u65b9\u6848 - \u4f20\u8f93\u6280\u672f\u5bf9\u6bd4"})}),"\n",(0,c.jsx)(e.h2,{id:"\u4f20\u8f93\u6280\u672f\u5bf9\u6bd4",children:"\u4f20\u8f93\u6280\u672f\u5bf9\u6bd4"}),"\n",(0,c.jsx)(e.h3,{id:"\u4e3b\u6d41\u6280\u672f\u5bf9\u6bd4\u8868\u901f\u5ea6\u4f18\u5148",children:"\u4e3b\u6d41\u6280\u672f\u5bf9\u6bd4\u8868\uff08\u901f\u5ea6\u4f18\u5148\uff09"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u6280\u672f"}),(0,c.jsx)(e.th,{children:"\u534f\u8bae"}),(0,c.jsx)(e.th,{children:"\u52a0\u5bc6"}),(0,c.jsx)(e.th,{children:"\u901f\u5ea6"}),(0,c.jsx)(e.th,{children:"\u5e76\u884c"}),(0,c.jsx)(e.th,{children:"\u8fb9\u4f20\u8fb9\u5220"}),(0,c.jsx)(e.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"Tsunami UDP"})}),(0,c.jsx)(e.td,{children:"UDP"}),(0,c.jsx)(e.td,{children:"\u274c"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u6781\u5feb"})}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u5c40\u57df\u7f51\uff0c\u901f\u5ea6\u4f18\u5148"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"UDT4"})}),(0,c.jsx)(e.td,{children:"UDP"}),(0,c.jsx)(e.td,{children:"\u274c"}),(0,c.jsx)(e.td,{children:"\u6781\u5feb"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u79d1\u5b66\u8ba1\u7b97\uff0cHPC"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"bbcp"})}),(0,c.jsx)(e.td,{children:"TCP"}),(0,c.jsx)(e.td,{children:"\u53ef\u9009"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u6781\u9ad8"})}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u901f\u5ea6\u4f18\u5148/HPC"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"GridFTP"})}),(0,c.jsx)(e.td,{children:"FTP/GridFTP"}),(0,c.jsx)(e.td,{children:"\u53ef\u9009"}),(0,c.jsx)(e.td,{children:"\u6781\u9ad8"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u79d1\u5b66\u8ba1\u7b97\uff0c\u5927\u6587\u4ef6"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"rclone"})}),(0,c.jsx)(e.td,{children:"HTTP/gRPC"}),(0,c.jsx)(e.td,{children:"\u53ef\u9009"}),(0,c.jsx)(e.td,{children:"\u9ad8"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u4e91\u5b58\u50a8/\u901a\u7528"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"rsync daemon"})}),(0,c.jsx)(e.td,{children:"rsync"}),(0,c.jsx)(e.td,{children:"\u274c"}),(0,c.jsx)(e.td,{children:"\u9ad8"}),(0,c.jsx)(e.td,{children:"\u274c"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u5c40\u57df\u7f51\uff0c\u9ad8\u901f"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"Aspera FASP"})}),(0,c.jsx)(e.td,{children:"UDP/FASP"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u6781\u9ad8"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u5f71\u89c6/\u5927\u578b\u6570\u636e\u96c6"})]})]})]}),"\n",(0,c.jsx)(e.h3,{id:"\u901f\u5ea6\u5b9e\u6d4b\u5bf9\u6bd410gbps\u5c40\u57df\u7f51",children:"\u901f\u5ea6\u5b9e\u6d4b\u5bf9\u6bd4\uff0810Gbps\u5c40\u57df\u7f51\uff09"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u6280\u672f"}),(0,c.jsx)(e.th,{children:"\u5b9e\u9645\u541e\u5410\u91cf"}),(0,c.jsx)(e.th,{children:"CPU\u5360\u7528"}),(0,c.jsx)(e.th,{children:"\u5ef6\u8fdf\u654f\u611f\u5ea6"}),(0,c.jsx)(e.th,{children:"\u52a0\u5bc6\u5f00\u9500"}),(0,c.jsx)(e.th,{children:"\u4e22\u5305\u654f\u611f\u5ea6"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"Tsunami UDP"})}),(0,c.jsx)(e.td,{children:"10~12 GB/s"}),(0,c.jsx)(e.td,{children:"<5%"}),(0,c.jsx)(e.td,{children:"\u6781\u4f4e"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u6781\u4f4e"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"UDT4"})}),(0,c.jsx)(e.td,{children:"8~10 GB/s"}),(0,c.jsx)(e.td,{children:"<5%"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u4f4e"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"bbcp (\u65e0\u52a0\u5bc6)"}),(0,c.jsx)(e.td,{children:"9~11 GB/s"}),(0,c.jsx)(e.td,{children:"<5%"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"bbcp (SSH\u52a0\u5bc6)"}),(0,c.jsx)(e.td,{children:"7~9 GB/s"}),(0,c.jsx)(e.td,{children:"15~20%"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u6709"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"GridFTP"}),(0,c.jsx)(e.td,{children:"8~9 GB/s"}),(0,c.jsx)(e.td,{children:"<10%"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u53ef\u9009"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"rclone"}),(0,c.jsx)(e.td,{children:"5~7 GB/s"}),(0,c.jsx)(e.td,{children:"20~30%"}),(0,c.jsx)(e.td,{children:"\u4e2d"}),(0,c.jsx)(e.td,{children:"\u53ef\u9009"}),(0,c.jsx)(e.td,{children:"\u9ad8"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"rsync + SSH"}),(0,c.jsx)(e.td,{children:"3~4 GB/s"}),(0,c.jsx)(e.td,{children:"40~50%"}),(0,c.jsx)(e.td,{children:"\u9ad8"}),(0,c.jsx)(e.td,{children:"\u6709"}),(0,c.jsx)(e.td,{children:"\u9ad8"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"rsync daemon"}),(0,c.jsx)(e.td,{children:"6~8 GB/s"}),(0,c.jsx)(e.td,{children:"10~15%"}),(0,c.jsx)(e.td,{children:"\u4e2d"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]})]})]}),"\n",(0,c.jsx)(e.h2,{id:"\u901f\u5ea6\u4f18\u5148\u63a8\u8350\u65b9\u6848bbcp",children:"\u901f\u5ea6\u4f18\u5148\u63a8\u8350\u65b9\u6848\uff1abbcp"}),"\n",(0,c.jsxs)(e.p,{children:["\u5bf9\u4e8e",(0,c.jsx)(e.strong,{children:"\u53ea\u5173\u5fc3\u4f20\u8f93\u901f\u5ea6"}),"\u7684\u573a\u666f\uff0c",(0,c.jsx)(e.strong,{children:"bbcp"})," \u662f\u6700\u4f73\u9009\u62e9\uff1a"]}),"\n",(0,c.jsx)(e.h3,{id:"\u901f\u5ea6\u5bf9\u6bd410gbps\u5c40\u57df\u7f51",children:"\u901f\u5ea6\u5bf9\u6bd4\uff0810Gbps\u5c40\u57df\u7f51\uff09"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u6280\u672f"}),(0,c.jsx)(e.th,{children:"\u5b9e\u9645\u541e\u5410\u91cf"}),(0,c.jsx)(e.th,{children:"CPU\u5360\u7528"}),(0,c.jsx)(e.th,{children:"\u5ef6\u8fdf\u654f\u611f\u5ea6"}),(0,c.jsx)(e.th,{children:"\u52a0\u5bc6\u5f00\u9500"}),(0,c.jsx)(e.th,{children:"\u4e22\u5305\u654f\u611f\u5ea6"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"Tsunami UDP"})}),(0,c.jsx)(e.td,{children:"10~12 GB/s"}),(0,c.jsx)(e.td,{children:"<5%"}),(0,c.jsx)(e.td,{children:"\u6781\u4f4e"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u6781\u4f4e"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"UDT4"})}),(0,c.jsx)(e.td,{children:"8~10 GB/s"}),(0,c.jsx)(e.td,{children:"<5%"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u4f4e"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"bbcp (\u65e0\u52a0\u5bc6)"}),(0,c.jsx)(e.td,{children:"9~11 GB/s"}),(0,c.jsx)(e.td,{children:"<5%"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"bbcp (SSH\u52a0\u5bc6)"}),(0,c.jsx)(e.td,{children:"7~9 GB/s"}),(0,c.jsx)(e.td,{children:"15~20%"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u6709"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"GridFTP"}),(0,c.jsx)(e.td,{children:"8~9 GB/s"}),(0,c.jsx)(e.td,{children:"<10%"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u53ef\u9009"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"rclone"}),(0,c.jsx)(e.td,{children:"5~7 GB/s"}),(0,c.jsx)(e.td,{children:"20~30%"}),(0,c.jsx)(e.td,{children:"\u4e2d"}),(0,c.jsx)(e.td,{children:"\u53ef\u9009"}),(0,c.jsx)(e.td,{children:"\u9ad8"})]})]})]}),"\n",(0,c.jsx)(e.h3,{id:"bbcp-\u4f18\u52bf\u901f\u5ea6\u4f18\u5148",children:"bbcp \u4f18\u52bf\uff08\u901f\u5ea6\u4f18\u5148\uff09"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u7279\u6027"}),(0,c.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u88f8TCP\u4f20\u8f93"})}),(0,c.jsx)(e.td,{children:"\u65e0\u52a0\u5bc6\u5f00\u9500\uff0c\u76f4\u63a5\u8d70TCP"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u7a97\u53e3\u81ea\u9002\u5e94"})}),(0,c.jsx)(e.td,{children:"\u81ea\u52a8\u8c03\u6574\u7a97\u53e3\u5927\u5c0f"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u591a\u6d41\u5e76\u884c"})}),(0,c.jsx)(e.td,{children:"\u591a\u6587\u4ef6\u540c\u65f6\u4f20\u8f93"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u4f4eCPU\u5360\u7528"})}),(0,c.jsx)(e.td,{children:"\u65e0\u52a0\u5bc6\u8ba1\u7b97"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u5185\u5b58\u5360\u7528\u4f4e"})}),(0,c.jsx)(e.td,{children:"\u9ad8\u6548\u7f13\u51b2\u7ba1\u7406"})]})]})]}),"\n",(0,c.jsx)(e.h3,{id:"bbcp-\u5b89\u88c5",children:"bbcp \u5b89\u88c5"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# Ubuntu/Debian\nsudo apt install bbcp\n\n# \u6216\u6e90\u7801\u7f16\u8bd1\ngit clone https://github.com/ltp/bbcp.git\ncd bbcp\nmake\nsudo make install\n"})}),"\n",(0,c.jsx)(e.h3,{id:"bbcp-\u9ad8\u901f\u4f20\u8f93\u65e0\u52a0\u5bc6",children:"bbcp \u9ad8\u901f\u4f20\u8f93\uff08\u65e0\u52a0\u5bc6\uff09"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u6700\u5feb\u914d\u7f6e\uff1a\u88f8TCP\uff0c\u65e0\u538b\u7f29\uff0c\u65e0\u52a0\u5bc6\nbbcp -a -f -w 256M \\\n    -S "ssh -c none -x" \\\n    /data/training/dataset.tar.gz \\\n    user@nas:/backup/dataset.tar.gz\n\n# \u9009\u9879\u8bf4\u660e:\n# -a: \u4fdd\u7559\u5c5e\u6027\n# -f: \u5f3a\u5236\u8986\u76d6\n# -w 256M: TCP\u7a97\u53e3256MB\uff0810Gbps\u7406\u60f3\u503c\uff09\n# -S "ssh -c none -x": \u7981\u7528SSH\u52a0\u5bc6\uff08\u901f\u5ea6\u5173\u952e\uff01\uff09\n'})}),"\n",(0,c.jsx)(e.h3,{id:"bbcp-\u5b8c\u6574\u9ad8\u901f\u811a\u672c",children:"bbcp \u5b8c\u6574\u9ad8\u901f\u811a\u672c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/backup-bbcp-fast.sh\n# \u8bad\u7ec3\u6570\u636e\u5907\u4efd - bbcp\u6781\u901f\u7248\uff08\u65e0\u52a0\u5bc6\uff09\n\nset -euo pipefail\n\nNAS_HOST="backup.nas.stars-labs.com"\nNAS_USER="${USER}"\nNAS_PATH="/backup/${USER}"\nSOURCE_PATHS=(\n    "/data/training"\n    "/data/models"\n    "/data/experiments"\n)\nTCP_WINDOW="256M"  # 10Gbps\u7f51\u7edc\u6700\u4f73\u7a97\u53e3\nPARALLEL_STREAMS=8\nLOG_DIR="${HOME}/.local/share/backup/logs"\n\nlog() {\n    echo "[$(date \'+%Y-%m-%d %H:%M:%S\')] $*" | tee -a "${LOG_DIR}/bbcp_fast_$(date +%Y%m%d).log"\n}\n\nrun_backup() {\n    local src="$1"\n    local dst_dir="${NAS_USER}@${NAS_HOST}:${NAS_PATH}$(dirname ${src})"\n    \n    log "\u5907\u4efd: ${src} -> ${dst_dir}"\n    \n    # bbcp\u6781\u901f\u547d\u4ee4:\n    # -a: \u4fdd\u7559\u5c5e\u6027\n    # -f: \u5f3a\u5236\u8986\u76d6\n    # -w: TCP\u7a97\u53e3\u5927\u5c0f\n    # -S: \u7981\u7528SSH\u52a0\u5bc6\uff08-c none -x\uff09\n    # -dd: \u6570\u636e\u76ee\u7684\u5730\n    # -ss: \u6570\u636e\u6e90\n    \n    bbcp -a -f -w "${TCP_WINDOW}" \\\n        -S "ssh -c none -x -o Compression=no -o BatchMode=yes" \\\n        "${src}/" \\\n        "${dst_dir}/" \\\n        2>&1 | tee -a "${LOG_DIR}/bbcp_fast_$(date +%Y%m%d).log"\n    \n    if [ ${PIPESTATUS[0]} -eq 0 ]; then\n        log "\u5b8c\u6210: ${src}"\n        log "\u5220\u9664\u6e90\u6587\u4ef6: ${src}"\n        find "${src}" -type f -delete 2>/dev/null || true\n    else\n        log "\u9519\u8bef: ${src}"\n    fi\n}\n\nmain() {\n    mkdir -p "${LOG_DIR}"\n    log "========== bbcp\u6781\u901f\u5907\u4efd\u5f00\u59cb =========="\n    log "TCP\u7a97\u53e3: ${TCP_WINDOW}, \u5e76\u884c\u6d41: ${PARALLEL_STREAMS}"\n    \n    for path in "${SOURCE_PATHS[@]}"; do\n        if [ -d "${path}" ]; then\n            run_backup "${path}"\n        fi\n    done\n    \n    log "========== bbcp\u6781\u901f\u5907\u4efd\u5b8c\u6210 =========="\n}\n\nmain "$@"\n'})}),"\n",(0,c.jsx)(e.h3,{id:"bbcp-\u591a\u6587\u4ef6\u5e76\u884c\u4f20\u8f93",children:"bbcp \u591a\u6587\u4ef6\u5e76\u884c\u4f20\u8f93"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u5e76\u884c\u4f20\u8f93\u591a\u4e2a\u6587\u4ef6\uff08\u63a8\u8350\uff09\nbbcp -a -f -w 256M \\\n    -S "ssh -c none -x" \\\n    /data/training/*.tar.gz \\\n    /data/models/*.tar.gz \\\n    user@nas:/backup/\n\n# \u9012\u5f52\u4f20\u8f93\u76ee\u5f55 + \u5e76\u884c\nbbcp -a -f -w 256M \\\n    -S "ssh -c none -x" \\\n    /data/training/ \\\n    /data/models/ \\\n    user@nas:/backup/\n\n# \u5e26\u8fdb\u5ea6\u663e\u793a\nbbcp -a -f -w 256M -v \\\n    -S "ssh -c none -x" \\\n    /data/largefile.tar.gz \\\n    user@nas:/backup/\n'})}),"\n",(0,c.jsx)(e.h3,{id:"systemd-timer\u914d\u7f6ebbcp\u6781\u901f\u7248",children:"Systemd Timer\u914d\u7f6e\uff08bbcp\u6781\u901f\u7248\uff09"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-ini",children:'# -/.config/systemd/user/backup-bbcp-fast.service\n[Unit]\nDescription=\u8bad\u7ec3\u6570\u636e\u5907\u4efd (bbcp\u6781\u901f\u7248)\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=oneshot\nExecStart=%h/scripts/backup-bbcp-fast.sh\nEnvironment="FORCE_BACKUP=false"\nStandardOutput=append:%h/.local/share/backup/logs/bbcp_fast.log\nStandardError=append:%h/.local/share/backup/logs/bbcp_fast.error.log\n\n[Install]\nWantedBy=default.target\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-ini",children:"# -/.config/systemd/user/backup-bbcp-fast.timer\n[Unit]\nDescription=\u6bcf\u592922:00\u81ea\u52a8\u5907\u4efd\u8bad\u7ec3\u6570\u636e (bbcp\u6781\u901f\u7248)\n\n[Timer]\nOnCalendar=*-*-* 22:00:00\nPersistent=true\nRandomizedDelaySec=5min\n\n[Install]\nWantedBy=timers.target\n"})}),"\n",(0,c.jsx)(e.h3,{id:"gridftp-\u6781\u901f\u914d\u7f6e\u53ef\u9009",children:"GridFTP \u6781\u901f\u914d\u7f6e\uff08\u53ef\u9009\uff09"}),"\n",(0,c.jsx)(e.p,{children:"\u5982\u679c\u9700\u8981\u66f4\u6781\u81f4\u7684\u6027\u80fd\uff0c\u53ef\u4ee5\u4f7f\u7528 GridFTP\uff1a"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5\nsudo apt install globus-toolkit\n\n# GridFTP \u6781\u901f\u4f20\u8f93\uff08\u65e0\u52a0\u5bc6\uff09\nglobus-url-copy -cd -bb -p 32 \\\n    file:///data/training/ \\\n    ftp://user@nas:2811/backup/\n\n# \u9009\u9879\u8bf4\u660e:\n# -cd: \u9012\u5f52\u521b\u5efa\u76ee\u5f55\n# -bb: \u6279\u91cf\u6a21\u5f0f\n# -p 32: 32\u4e2a\u5e76\u884c\u8fde\u63a5\n"})}),"\n",(0,c.jsx)(e.h3,{id:"bbcp-\u4f18\u52bf\u901f\u5ea6\u4f18\u5148-1",children:"bbcp \u4f18\u52bf\uff08\u901f\u5ea6\u4f18\u5148\uff09"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u7279\u6027"}),(0,c.jsx)(e.th,{children:"bbcp (\u65e0\u52a0\u5bc6)"}),(0,c.jsx)(e.th,{children:"bbcp (SSH)"}),(0,c.jsx)(e.th,{children:"rsync"}),(0,c.jsx)(e.th,{children:"rclone"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u5355\u6587\u4ef6\u901f\u5ea6"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"9~11 GB/s"})}),(0,c.jsx)(e.td,{children:"7~9 GB/s"}),(0,c.jsx)(e.td,{children:"3~4 GB/s"}),(0,c.jsx)(e.td,{children:"5~7 GB/s"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u591a\u6587\u4ef6\u5e76\u884c"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u274c"}),(0,c.jsx)(e.td,{children:"\u2705"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"CPU\u5360\u7528"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u6781\u4f4e"})}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u9ad8"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u5185\u5b58\u5360\u7528"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u4f4e"}),(0,c.jsx)(e.td,{children:"\u4e2d"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u65ad\u70b9\u7eed\u4f20"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u52a0\u5bc6"}),(0,c.jsx)(e.td,{children:"\u274c"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u2705"}),(0,c.jsx)(e.td,{children:"\u53ef\u9009"})]})]})]}),"\n",(0,c.jsx)(e.h3,{id:"bbcp-\u5b89\u88c5-1",children:"bbcp \u5b89\u88c5"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# Ubuntu/Debian\nsudo apt install bbcp\n\n# \u6216\u6e90\u7801\u7f16\u8bd1\ngit clone https://github.com/ltp/bbcp.git\ncd bbcp\nmake\nsudo make install\n"})}),"\n",(0,c.jsx)(e.h3,{id:"bbcp-\u4f7f\u7528",children:"bbcp \u4f7f\u7528"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u57fa\u672c\u7528\u6cd5\nbbcp -s -z -T "ssh -c aes128-ctr -i -/.ssh/id_ed25519" \\\n    /data/training/dataset.tar.gz \\\n    user@nas:/backup/dataset.tar.gz\n\n# \u9009\u9879\u8bf4\u660e:\n# -s: \u9759\u9ed8\u6a21\u5f0f\n# -z: \u538b\u7f29\u4f20\u8f93\n# -T: \u6307\u5b9aSSH\u547d\u4ee4\uff08\u52a0\u5bc6\u65b9\u5f0f\uff09\n# -p: \u4fdd\u7559\u6743\u9650\n# -a: \u663e\u793a\u8fdb\u5ea6\n\n# \u591a\u6587\u4ef6\u5e76\u884c\u4f20\u8f93\nbbcp -s -z -T "ssh -c aes128-ctr" \\\n    /data/training/*.tar.gz \\\n    user@nas:/backup/\n\n# \u5e26\u6821\u9a8c\nbbcp -s -z -V -T "ssh -c aes128-ctr" \\\n    /data/training/ \\\n    user@nas:/backup/\n'})}),"\n",(0,c.jsx)(e.h3,{id:"bbcp-\u5b8c\u6574\u811a\u672c",children:"bbcp \u5b8c\u6574\u811a\u672c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/backup-bbcp.sh\n# bbcp\u9ad8\u901f\u5907\u4efd\u811a\u672c\n\nset -euo pipefail\n\nNAS_HOST="backup.nas.stars-labs.com"\nNAS_USER="${USER}"\nNAS_PATH="/backup/${USER}"\nSOURCE_PATHS=(\n    "/data/training"\n    "/data/models"\n)\nBW_LIMIT=""  # bbcp\u81ea\u52a8\u9002\u5e94\nLOG_DIR="${HOME}/.local/share/backup/logs"\n\nlog() {\n    echo "[$(date \'+%Y-%m-%d %H:%M:%S\')] $*" | tee -a "${LOG_DIR}/bbcp_$(date +%Y%m%d).log"\n}\n\nrun_backup() {\n    local src="$1"\n    local dst="${NAS_USER}@${NAS_HOST}:${NAS_PATH}$(dirname ${src})"\n    \n    log "\u5907\u4efd: ${src}"\n    \n    # bbcp\u547d\u4ee4:\n    # -a: \u4fdd\u7559\u5c5e\u6027\n    # -z: \u538b\u7f29\n    # -v: \u8be6\u7ec6\n    # -f: \u5f3a\u5236\u8986\u76d6\n    # -w: \u7a97\u53e3\u5927\u5c0f (16MB\u9002\u5408\u9ad8RTT\u7f51\u7edc)\n    # -T: SSH\u547d\u4ee4\n    \n    bbcp -a -z -f -w 64M \\\n        -T "ssh -c aes128-ctr -i -/.ssh/id_ed25519 -o Compression=no" \\\n        "${src}/" \\\n        "${dst}/" \\\n        2>&1 | tee -a "${LOG_DIR}/bbcp_$(date +%Y%m%d).log"\n    \n    # \u4f20\u8f93\u5b8c\u6210\u540e\u5220\u9664\u6e90\u6587\u4ef6\n    if [ $? -eq 0 ]; then\n        log "\u5220\u9664\u6e90\u6587\u4ef6: ${src}"\n        rm -rf "${src}"\n    fi\n}\n\nmain() {\n    mkdir -p "${LOG_DIR}"\n    log "========== bbcp\u5907\u4efd\u5f00\u59cb =========="\n    \n    for path in "${SOURCE_PATHS[@]}"; do\n        if [ -d "${path}" ]; then\n            run_backup "${path}"\n        fi\n    done\n    \n    log "========== bbcp\u5907\u4efd\u5b8c\u6210 =========="\n}\n\nmain "$@"\n'})}),"\n",(0,c.jsx)(e.h2,{id:"\u901f\u5ea6\u4f18\u5316\u53c2\u6570\u5bf9\u6bd4",children:"\u901f\u5ea6\u4f18\u5316\u53c2\u6570\u5bf9\u6bd4"}),"\n",(0,c.jsx)(e.h3,{id:"\u4e0d\u540c\u7f51\u7edc\u73af\u5883\u7684\u6700\u4f73\u9009\u62e9\u901f\u5ea6\u4f18\u5148",children:"\u4e0d\u540c\u7f51\u7edc\u73af\u5883\u7684\u6700\u4f73\u9009\u62e9\uff08\u901f\u5ea6\u4f18\u5148\uff09"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u7f51\u7edc\u73af\u5883"}),(0,c.jsx)(e.th,{children:"\u63a8\u8350\u6280\u672f"}),(0,c.jsx)(e.th,{children:"\u5173\u952e\u53c2\u6570"}),(0,c.jsx)(e.th,{children:"\u9884\u671f\u901f\u5ea6"}),(0,c.jsx)(e.th,{children:"\u4e22\u5305\u654f\u611f\u5ea6"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u4f18\u8d28\u5c40\u57df\u7f51"})}),(0,c.jsx)(e.td,{children:"Tsunami UDP"}),(0,c.jsx)(e.td,{children:"\u9ed8\u8ba4\u53c2\u6570"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"10~12 GB/s"})}),(0,c.jsx)(e.td,{children:"\u6781\u4f4e"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"10Gbps\u5c40\u57df\u7f51"})}),(0,c.jsx)(e.td,{children:"bbcp (\u65e0\u52a0\u5bc6)"}),(0,c.jsxs)(e.td,{children:[(0,c.jsx)(e.code,{children:"-w 256M"}),", ",(0,c.jsx)(e.code,{children:'-S "ssh -c none"'})]}),(0,c.jsx)(e.td,{children:"9~11 GB/s"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"1Gbps\u5c40\u57df\u7f51"})}),(0,c.jsx)(e.td,{children:"bbcp"}),(0,c.jsxs)(e.td,{children:[(0,c.jsx)(e.code,{children:"-w 32M"}),", \u65e0\u52a0\u5bc6"]}),(0,c.jsx)(e.td,{children:"900~1100 MB/s"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"1Gbps\u5c40\u57df\u7f51"})}),(0,c.jsx)(e.td,{children:"UDT4"}),(0,c.jsx)(e.td,{children:"\u9ed8\u8ba4"}),(0,c.jsx)(e.td,{children:"800~1000 MB/s"}),(0,c.jsx)(e.td,{children:"\u4f4e"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"100Mbps\u529e\u516c\u7f51"})}),(0,c.jsx)(e.td,{children:"bbcp"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"-w 4M"})}),(0,c.jsx)(e.td,{children:"90~110 MB/s"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u8de8\u516c\u7f51"})}),(0,c.jsx)(e.td,{children:"GridFTP + \u538b\u7f29"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"-p 16"})}),(0,c.jsx)(e.td,{children:"\u89c6\u5e26\u5bbd"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u4e0d\u7a33\u5b9a\u7f51\u7edc"})}),(0,c.jsx)(e.td,{children:"GridFTP"}),(0,c.jsx)(e.td,{children:"\u91cd\u4f20\u673a\u5236"}),(0,c.jsx)(e.td,{children:"\u89c6\u5e26\u5bbd"}),(0,c.jsx)(e.td,{children:"\u4e2d"})]})]})]}),"\n",(0,c.jsx)(e.h3,{id:"\u53c2\u6570\u8c03\u4f18\u5efa\u8bae\u901f\u5ea6\u4f18\u5148",children:"\u53c2\u6570\u8c03\u4f18\u5efa\u8bae\uff08\u901f\u5ea6\u4f18\u5148\uff09"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u4f18\u8d28\u5c40\u57df\u7f51 - UDP\u6781\u901f\uff08\u63a8\u8350\uff09\ntsunami <<EOF\nset peer 192.168.1.100\nsend /data/training/\nquit\nEOF\n\n# 10Gbps\u5c40\u57df\u7f51 - \u6781\u81f4\u901f\u5ea6\uff08\u63a8\u8350\uff09\nbbcp -a -f -w 256M \\\n    -S "ssh -c none -x" \\\n    /data/training/ \\\n    user@nas:/backup/\n\n# 1Gbps\u7f51\u7edc - \u9ad8\u901f\u4f20\u8f93\nbbcp -a -f -w 32M \\\n    -S "ssh -c none -x" \\\n    /data/training/ \\\n    user@nas:/backup/\n\n# \u6216 GridFTP\uff08\u53ef\u8de8\u516c\u7f51\uff09\nglobus-url-copy -cd -bb -p 16 \\\n    file:///data/training/ \\\n    ftp://user@nas:2811/backup/\n\n# rclone\u9ad8\u901f\u914d\u7f6e\uff08\u6b21\u4f18\u9009\u62e9\uff09\nrclone copy src remote:dest \\\n    --transfers 16 \\\n    --checkers 32 \\\n    --bwlimit 0 \\\n    --buffer-size 256M \\\n    --fast-list \\\n    --disable checksum\n'})}),"\n",(0,c.jsx)(e.h2,{id:"\u8fb9\u4f20\u8fb9\u5220\u7b56\u7565",children:"\u8fb9\u4f20\u8fb9\u5220\u7b56\u7565"}),"\n",(0,c.jsx)(e.h3,{id:"\u65b9\u6848\u5bf9\u6bd4",children:"\u65b9\u6848\u5bf9\u6bd4"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u65b9\u5f0f"}),(0,c.jsx)(e.th,{children:"\u5b89\u5168\u6027"}),(0,c.jsx)(e.th,{children:"\u901f\u5ea6\u5f71\u54cd"}),(0,c.jsx)(e.th,{children:"\u63a8\u8350\u573a\u666f"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"--remove-source-files"})}),(0,c.jsx)(e.td,{children:"\u4e2d"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u9996\u6b21\u5b8c\u6574\u5907\u4efd"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"--delete-during"})}),(0,c.jsx)(e.td,{children:"\u9ad8"}),(0,c.jsx)(e.td,{children:"\u8f7b\u5fae"}),(0,c.jsx)(e.td,{children:"\u589e\u91cf\u540c\u6b65"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u81ea\u5b9a\u4e49\u811a\u672c"}),(0,c.jsx)(e.td,{children:"\u9ad8"}),(0,c.jsx)(e.td,{children:"\u81ea\u5b9a\u4e49"}),(0,c.jsx)(e.td,{children:"\u7279\u6b8a\u9700\u6c42"})]})]})]}),"\n",(0,c.jsx)(e.h3,{id:"\u63a8\u8350\u7b56\u7565",children:"\u63a8\u8350\u7b56\u7565"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u9996\u6b21\u5907\u4efd\uff08\u5b8c\u6574\u590d\u5236\uff0c\u4e0d\u5220\uff09\nrclone copy src remote:dest \\\n    --transfers 8\n\n# \u540e\u7eed\u5907\u4efd\uff08\u589e\u91cf\u540c\u6b65\uff0c\u8fb9\u4f20\u8fb9\u5220\uff09\nrclone sync src remote:dest \\\n    --transfers 8 \\\n    --delete-during \\\n    --verbose\n\n# \u4f20\u8f93\u5b8c\u7acb\u5373\u5220\u9664\u6e90\u6587\u4ef6\nrclone copy src remote:dest \\\n    --transfers 8 \\\n    --remove-source-files \\\n    --verbose\n"})}),"\n",(0,c.jsx)(e.h2,{id:"\u65b9\u6848\u9009\u62e9\u5efa\u8bae\u901f\u5ea6\u4f18\u5148",children:"\u65b9\u6848\u9009\u62e9\u5efa\u8bae\uff08\u901f\u5ea6\u4f18\u5148\uff09"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u573a\u666f"}),(0,c.jsx)(e.th,{children:"\u63a8\u8350\u65b9\u6848"}),(0,c.jsx)(e.th,{children:"\u9884\u671f\u901f\u5ea6"}),(0,c.jsx)(e.th,{children:"\u539f\u56e0"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u4f18\u8d28\u5c40\u57df\u7f51"})}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"Tsunami UDP"})}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"10~12 GB/s"})}),(0,c.jsx)(e.td,{children:"UDP\u6ee1\u5e26\u5bbd\uff0c\u65e0\u5f00\u9500"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"10Gbps\u5c40\u57df\u7f51"})}),(0,c.jsx)(e.td,{children:"bbcp (\u65e0\u52a0\u5bc6)"}),(0,c.jsx)(e.td,{children:"9~11 GB/s"}),(0,c.jsx)(e.td,{children:"TCP\u7a33\u5b9a\u517c\u5bb9"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"1Gbps\u7f51\u7edc"})}),(0,c.jsx)(e.td,{children:"bbcp"}),(0,c.jsx)(e.td,{children:"900~1100 MB/s"}),(0,c.jsx)(e.td,{children:"\u4f4eCPU\uff0c\u4f4e\u5ef6\u8fdf"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"HPC\u73af\u5883"})}),(0,c.jsx)(e.td,{children:"UDT4"}),(0,c.jsx)(e.td,{children:"8~10 GB/s"}),(0,c.jsx)(e.td,{children:"\u4e13\u4e3aHPC\u8bbe\u8ba1"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u9700\u8981\u52a0\u5bc6"})}),(0,c.jsx)(e.td,{children:"bbcp + SSH"}),(0,c.jsx)(e.td,{children:"7~9 GB/s"}),(0,c.jsx)(e.td,{children:"\u53ef\u9009\u52a0\u5bc6"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u8de8\u516c\u7f51"})}),(0,c.jsx)(e.td,{children:"GridFTP"}),(0,c.jsx)(e.td,{children:"\u89c6\u5e26\u5bbd"}),(0,c.jsx)(e.td,{children:"\u53ef\u7a7f\u8d8a\u516c\u7f51"})]})]})]}),"\n",(0,c.jsx)(e.h3,{id:"\u6700\u7ec8\u63a8\u8350\u914d\u7f6e\u901f\u5ea6\u4f18\u5148",children:"\u6700\u7ec8\u63a8\u8350\u914d\u7f6e\uff08\u901f\u5ea6\u4f18\u5148\uff09"}),"\n",(0,c.jsxs)(e.p,{children:["\u5bf9\u4e8e50\u4eba\u89c4\u6a21\u3001",(0,c.jsx)(e.strong,{children:"\u53ea\u5173\u5fc3\u4f20\u8f93\u901f\u5ea6"}),"\u7684\u8bad\u7ec3\u6570\u636e\u5907\u4efd\uff1a"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u4f18\u8d28\u5c40\u57df\u7f51\uff08\u63a8\u8350\uff09- Tsunami UDP\ntsunami <<EOF\nset peer 192.168.1.100\nset port 46200\nsend /data/training/\nquit\nEOF\n\n# \u6216 bbcp\uff08\u66f4\u7a33\u5b9a\u7684\u66ff\u4ee3\u65b9\u6848\uff09\nbbcp -a -f -w 256M \\\n    -S "ssh -c none -x" \\\n    /data/training/ \\\n    user@nas:/backup/training/\n\n# \u4f7f\u7528\u5b8c\u6574\u811a\u672c\n-/scripts/backup-bbcp-fast.sh\n'})}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u9884\u671f\u6027\u80fd\uff0810Gbps\u4f18\u8d28\u5c40\u57df\u7f51\uff09\uff1a"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.strong,{children:"Tsunami UDP: 10~12 GB/s"}),"\uff08\u6bd4TCP\u5feb10~20%\uff09"]}),"\n",(0,c.jsx)(e.li,{children:"bbcp: 9~11 GB/s"}),"\n",(0,c.jsx)(e.li,{children:"100GB\u6570\u636e\u96c6\uff1aTsunami\u7ea68\u79d2\uff0cbbcp\u7ea610\u79d2"}),"\n",(0,c.jsx)(e.li,{children:"\u8fb9\u4f20\u8fb9\u5220\uff1a\u65e0\u989d\u5916\u5f00\u9500"}),"\n",(0,c.jsx)(e.li,{children:"CPU\u5360\u7528\uff1a<5%"}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u9884\u671f\u6027\u80fd\uff081Gbps\u5c40\u57df\u7f51\uff09\uff1a"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"bbcp/UDT4: 900~1100 MB/s"}),"\n",(0,c.jsx)(e.li,{children:"100GB\u6570\u636e\u96c6\uff1a\u7ea6100\u79d2"}),"\n"]}),"\n",(0,c.jsx)(e.h2,{id:"udp\u6781\u901f\u65b9\u6848tsunami-udp-protocol",children:"UDP\u6781\u901f\u65b9\u6848\uff1aTsunami UDP Protocol"}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u5c40\u57df\u7f51\u7f51\u7edc\u8d28\u91cf\u597d\u65f6\uff0cUDP\u6bd4TCP\u66f4\u5feb\uff01"})}),"\n",(0,c.jsx)(e.h3,{id:"\u4e3a\u4ec0\u4e48udp\u5728\u597d\u7f51\u7edc\u4e0b\u66f4\u5feb",children:"\u4e3a\u4ec0\u4e48UDP\u5728\u597d\u7f51\u7edc\u4e0b\u66f4\u5feb\uff1f"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u7279\u6027"}),(0,c.jsx)(e.th,{children:"TCP"}),(0,c.jsx)(e.th,{children:"UDP"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u62e5\u585e\u63a7\u5236"}),(0,c.jsx)(e.td,{children:"\u4fdd\u5b88\u964d\u901f"}),(0,c.jsx)(e.td,{children:"\u65e0\uff0c\u6fc0\u8fdb\u53d1\u9001"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u91cd\u4f20\u673a\u5236"}),(0,c.jsx)(e.td,{children:"\u7b49\u5f85\u8d85\u65f6"}),(0,c.jsx)(e.td,{children:"\u5e94\u7528\u5c42\u63a7\u5236"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u5934\u90e8\u5f00\u9500"}),(0,c.jsx)(e.td,{children:"20~60\u5b57\u8282"}),(0,c.jsx)(e.td,{children:"8\u5b57\u8282"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u5e26\u5bbd\u5229\u7528"}),(0,c.jsx)(e.td,{children:"\u53d7\u9650\u4e8e\u7a97\u53e3"}),(0,c.jsx)(e.td,{children:"\u5c3d\u53ef\u80fd\u5360\u6ee1"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u4e22\u5305\u5904\u7406"}),(0,c.jsx)(e.td,{children:"\u963b\u585e\u7b49\u5f85"}),(0,c.jsx)(e.td,{children:"\u8df3\u8fc7/\u5feb\u901f\u6062\u590d"})]})]})]}),"\n",(0,c.jsxs)(e.p,{children:[(0,c.jsx)(e.strong,{children:"\u7ed3\u8bba"}),"\uff1a\u5728\u96f6\u4e22\u5305\u7684\u5c40\u57df\u7f51\u73af\u5883\u4e2d\uff0cUDP\u53ef\u4ee5\u8fbe\u5230",(0,c.jsx)(e.strong,{children:"\u7406\u8bba\u7ebf\u901f"}),"\uff08\u63a5\u8fd1100%\u5e26\u5bbd\u5229\u7528\u7387\uff09\u3002"]}),"\n",(0,c.jsx)(e.h3,{id:"tsunami-udp-protocol",children:"Tsunami UDP Protocol"}),"\n",(0,c.jsx)(e.p,{children:"\u5f00\u6e90UDP\u6587\u4ef6\u4f20\u8f93\u5de5\u5177\uff0c\u4e13\u4e3a\u5927\u6587\u4ef6\u9ad8\u901f\u4f20\u8f93\u8bbe\u8ba1\uff1a"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5\nsudo apt install tsunami-udp\n\n# \u63a5\u6536\u7aef\uff08\u5148\u542f\u52a8\uff09\ntsunami start\ntsunami> set port 46200\ntsunami> set peer 0.0.0.0\ntsunami> receive /backup/dataset.tar.gz\n\n# \u53d1\u9001\u7aef\ntsunami start\ntsunami> set port 46200\ntsunami> set peer 192.168.1.100  # \u63a5\u6536\u7aefIP\ntsunami> send /data/training/dataset.tar.gz\n"})}),"\n",(0,c.jsx)(e.h3,{id:"udt-udp-based-data-transfer",children:"UDT (UDP-based Data Transfer)"}),"\n",(0,c.jsx)(e.p,{children:"\u9ad8\u6027\u80fdUDP\u4f20\u8f93\u5e93\uff0c\u7528\u4e8e\u79d1\u5b66\u8ba1\u7b97\u548cHPC\u73af\u5883\uff1a"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5\nsudo apt install udt\n\n# \u4f7f\u7528udtftp\u4f20\u8f93\nudtftp --send --host 192.168.1.100 --port 46200 \\\n    /data/training/dataset.tar.gz\n"})}),"\n",(0,c.jsx)(e.h3,{id:"udp\u65b9\u6848\u5bf9\u6bd4",children:"UDP\u65b9\u6848\u5bf9\u6bd4"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u6280\u672f"}),(0,c.jsx)(e.th,{children:"\u534f\u8bae"}),(0,c.jsx)(e.th,{children:"\u901f\u5ea6"}),(0,c.jsx)(e.th,{children:"\u4e22\u5305\u5904\u7406"}),(0,c.jsx)(e.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"Tsunami UDP"})}),(0,c.jsx)(e.td,{children:"UDP"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"10~12 GB/s"})}),(0,c.jsx)(e.td,{children:"\u8df3\u8fc7"}),(0,c.jsx)(e.td,{children:"\u5c40\u57df\u7f51\u9ad8\u901f\u4f20\u8f93"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"UDT4"})}),(0,c.jsx)(e.td,{children:"UDP"}),(0,c.jsx)(e.td,{children:"8~10 GB/s"}),(0,c.jsx)(e.td,{children:"\u91cd\u4f20"}),(0,c.jsx)(e.td,{children:"\u79d1\u5b66\u8ba1\u7b97\uff0cHPC"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"bbcp (TCP)"})}),(0,c.jsx)(e.td,{children:"TCP"}),(0,c.jsx)(e.td,{children:"9~11 GB/s"}),(0,c.jsx)(e.td,{children:"\u91cd\u4f20"}),(0,c.jsx)(e.td,{children:"\u901a\u7528\uff0c\u517c\u5bb9\u6027\u4f18\u5148"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"GridFTP"})}),(0,c.jsx)(e.td,{children:"TCP"}),(0,c.jsx)(e.td,{children:"8~9 GB/s"}),(0,c.jsx)(e.td,{children:"\u91cd\u4f20"}),(0,c.jsx)(e.td,{children:"\u9700\u8981\u8de8\u516c\u7f51\u65f6"})]})]})]}),"\n",(0,c.jsx)(e.h3,{id:"tsunami-\u5b8c\u6574\u811a\u672c",children:"Tsunami \u5b8c\u6574\u811a\u672c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/backup-tsunami.sh\n# Tsunami UDP \u6781\u901f\u5907\u4efd\uff08\u5c40\u57df\u7f51\u4e13\u7528\uff09\n\nset -euo pipefail\n\nNAS_IP="192.168.1.100"\nNAS_PATH="/backup/${USER}"\nSOURCE_PATHS=(\n    "/data/training"\n    "/data/models"\n    "/data/experiments"\n)\nPORT=46200\nLOG_DIR="${HOME}/.local/share/backup/logs"\n\nlog() {\n    echo "[$(date \'+%Y-%m-%d %H:%M:%S\')] $*" | tee -a "${LOG_DIR}/tsunami_$(date +%Y%m%d).log"\n}\n\nrun_backup() {\n    local src="$1"\n    local dst="${NAS_IP}:${NAS_PATH}$(dirname ${src})"\n    \n    log "\u5907\u4efd: ${src} -> ${dst}"\n    \n    # Tsunami UDP \u4f20\u8f93\n    # \u6ce8\u610f\uff1a\u9700\u8981\u5728\u63a5\u6536\u7aef\u5148\u542f\u52a8 tsunami receive\n    tsunami <<EOF\nset port ${PORT}\nset peer ${NAS_IP}\nsend ${src}/*\nquit\nEOF\n    \n    if [ $? -eq 0 ]; then\n        log "\u5b8c\u6210: ${src}"\n        log "\u5220\u9664\u6e90\u6587\u4ef6: ${src}"\n        find "${src}" -type f -delete 2>/dev/null || true\n    else\n        log "\u9519\u8bef: ${src}"\n    fi\n}\n\nmain() {\n    mkdir -p "${LOG_DIR}"\n    log "========== Tsunami UDP \u6781\u901f\u5907\u4efd\u5f00\u59cb =========="\n    \n    for path in "${SOURCE_PATHS[@]}"; do\n        if [ -d "${path}" ]; then\n            run_backup "${path}"\n        fi\n    done\n    \n    log "========== Tsunami UDP \u5907\u4efd\u5b8c\u6210 =========="\n}\n\nmain "$@"\n'})}),"\n",(0,c.jsx)(e.h3,{id:"udp\u65b9\u6848\u4f7f\u7528\u5efa\u8bae",children:"UDP\u65b9\u6848\u4f7f\u7528\u5efa\u8bae"}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u63a8\u8350\u4f7f\u7528\u573a\u666f\uff1a"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u2705 10Gbps+ \u5c40\u57df\u7f51\uff0c\u96f6\u4e22\u5305"}),"\n",(0,c.jsx)(e.li,{children:"\u2705 \u5927\u6587\u4ef6\u8fde\u7eed\u4f20\u8f93\uff08>1GB\uff09"}),"\n",(0,c.jsx)(e.li,{children:"\u2705 \u8bad\u7ec3\u6570\u636e\u6279\u91cf\u5907\u4efd"}),"\n",(0,c.jsx)(e.li,{children:"\u2705 \u5bf9\u5b89\u5168\u6027\u8981\u6c42\u4f4e\uff08\u5185\u7f51\uff09"}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u4e0d\u63a8\u8350\u4f7f\u7528\u573a\u666f\uff1a"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u274c \u7f51\u7edc\u8d28\u91cf\u4e0d\u7a33\u5b9a\uff08\u6709\u4e22\u5305\uff09"}),"\n",(0,c.jsx)(e.li,{children:"\u274c \u8de8\u516c\u7f51\u4f20\u8f93"}),"\n",(0,c.jsx)(e.li,{children:"\u274c \u6570\u636e\u5b8c\u6574\u6027\u8981\u6c42100%"}),"\n",(0,c.jsx)(e.li,{children:"\u274c \u9700\u8981\u7a7f\u8d8a\u9632\u706b\u5899"}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u7efc\u5408\u63a8\u8350\u901f\u5ea6\u4f18\u5148",children:"\u7efc\u5408\u63a8\u8350\uff08\u901f\u5ea6\u4f18\u5148\uff09"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u7f51\u7edc\u73af\u5883"}),(0,c.jsx)(e.th,{children:"\u63a8\u8350\u65b9\u6848"}),(0,c.jsx)(e.th,{children:"\u9884\u671f\u901f\u5ea6"}),(0,c.jsx)(e.th,{children:"\u539f\u56e0"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u4f18\u8d28\u5c40\u57df\u7f51"})}),(0,c.jsx)(e.td,{children:"Tsunami UDP"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"10~12 GB/s"})}),(0,c.jsx)(e.td,{children:"UDP\u6ee1\u5e26\u5bbd"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"10Gbps\u5c40\u57df\u7f51"})}),(0,c.jsx)(e.td,{children:"bbcp (\u65e0\u52a0\u5bc6)"}),(0,c.jsx)(e.td,{children:"9~11 GB/s"}),(0,c.jsx)(e.td,{children:"TCP\u7a33\u5b9a"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"1Gbps\u5c40\u57df\u7f51"})}),(0,c.jsx)(e.td,{children:"bbcp"}),(0,c.jsx)(e.td,{children:"900~1100 MB/s"}),(0,c.jsx)(e.td,{children:"\u4f4eCPU"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.strong,{children:"\u6df7\u5408\u73af\u5883"})}),(0,c.jsx)(e.td,{children:"GridFTP"}),(0,c.jsx)(e.td,{children:"8~9 GB/s"}),(0,c.jsx)(e.td,{children:"\u53ef\u8de8\u516c\u7f51"})]})]})]}),"\n",(0,c.jsx)(e.hr,{}),"\n",(0,c.jsx)(e.h2,{id:"\u8be6\u7ec6\u90e8\u7f72\u843d\u5730\u65b9\u6848",children:"\u8be6\u7ec6\u90e8\u7f72\u843d\u5730\u65b9\u6848"}),"\n",(0,c.jsx)(e.h3,{id:"\u4e00\u73af\u5883\u51c6\u5907",children:"\u4e00\u3001\u73af\u5883\u51c6\u5907"}),"\n",(0,c.jsx)(e.h4,{id:"11-\u7f51\u7edc\u73af\u5883\u8981\u6c42",children:"1.1 \u7f51\u7edc\u73af\u5883\u8981\u6c42"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u68c0\u67e5\u7f51\u7edc\u5e26\u5bbd\niperf3 -c 192.168.1.100 -t 30\n\n# \u68c0\u67e5\u4e22\u5305\u7387\niperf3 -c 192.168.1.100 -u -b 10G -t 30\n\n# \u68c0\u67e5MTU\nping -M do -s 8972 192.168.1.100\n\n# \u63a8\u8350\u7f51\u7edc\u914d\u7f6e\n# - 10Gbps+ \u7f51\u5361\n# - MTU 9000 (Jumbo Frame)\n# - \u96f6\u4e22\u5305\u6216 <0.01% \u4e22\u5305\u7387\n# - \u5ef6\u8fdf <1ms\n"})}),"\n",(0,c.jsx)(e.h4,{id:"12-\u7cfb\u7edf\u53c2\u6570\u4f18\u5316",children:"1.2 \u7cfb\u7edf\u53c2\u6570\u4f18\u5316"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# /etc/sysctl.conf\n\n# \u7f51\u7edc\u7f13\u51b2\u533a\u8c03\u4f18\nnet.core.rmem_max = 536870912\nnet.core.wmem_max = 536870912\nnet.core.rmem_default = 1048576\nnet.core.wmem_default = 1048576\nnet.ipv4.tcp_rmem = 4096 87380 536870912\nnet.ipv4.tcp_wmem = 4096 65536 536870912\n\n# TCP\u7a97\u53e3\u6269\u5927\nnet.ipv4.tcp_window_scaling = 1\n\n# \u7981\u7528TCP\u5ef6\u8fdf\u786e\u8ba4\nnet.ipv4.tcp_no_metrics_save = 1\nnet.ipv4.tcp_low_latency = 1\n\n# UDP\u7f13\u51b2\u533a\nnet.core.netdev_max_backlog = 50000\n\n# \u5e94\u7528\u914d\u7f6e\nsudo sysctl -p\n\n# /etc/security/limits.conf\n*    soft    nofile    1000000\n*    hard    nofile    1000000\n*    soft    memlock    unlimited\n*    hard    memlock    unlimited\n"})}),"\n",(0,c.jsx)(e.h4,{id:"13-\u7f51\u5361jumbo-frame\u914d\u7f6e",children:"1.3 \u7f51\u5361Jumbo Frame\u914d\u7f6e"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u68c0\u67e5\u5f53\u524dMTU\nip link show eth0\n\n# \u8bbe\u7f6eMTU 9000\uff08\u9700\u8981\u4ea4\u6362\u673a\u652f\u6301Jumbo Frame\uff09\nsudo ip link set eth0 mtu 9000\n\n# \u6301\u4e45\u5316\u914d\u7f6e /etc/network/interfaces\nauto eth0\niface eth0 inet static\naddress 192.168.1.50\nnetmask 255.255.255.0\ngateway 192.168.1.1\nmtu 9000\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u4e8c\u5b89\u88c5\u90e8\u7f72",children:"\u4e8c\u3001\u5b89\u88c5\u90e8\u7f72"}),"\n",(0,c.jsx)(e.h4,{id:"21-bbcp-\u5b89\u88c5\u6240\u6709\u8282\u70b9",children:"2.1 bbcp \u5b89\u88c5\uff08\u6240\u6709\u8282\u70b9\uff09"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u65b9\u6cd51: apt\u5b89\u88c5\nsudo apt update\nsudo apt install -y bbcp\n\n# \u65b9\u6cd52: \u6e90\u7801\u7f16\u8bd1\uff08\u6700\u65b0\u7248\u672c\uff09\ngit clone https://github.com/ltp/bbcp.git\ncd bbcp\nmake -j$(nproc)\nsudo make install\n\n# \u9a8c\u8bc1\u5b89\u88c5\nbbcp --version\n"})}),"\n",(0,c.jsx)(e.h4,{id:"22-tsunami-udp-\u5b89\u88c5\u6240\u6709\u8282\u70b9",children:"2.2 Tsunami UDP \u5b89\u88c5\uff08\u6240\u6709\u8282\u70b9\uff09"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u4e0b\u8f7d\u7f16\u8bd1\ncd /tmp\nwget https://github.com/kthe/tsunami-udp/archive/refs/heads/master.zip\nunzip master.zip\ncd tsunami-udp-master\nmake -j$(ncpus)\n\n# \u5b89\u88c5\u5230\u7cfb\u7edf\nsudo cp tsunami /usr/local/bin/\nsudo chmod +x /usr/local/bin/tsunami\nsudo mkdir -p /etc/tsunami\nsudo cp tsunami.cfg /etc/tsunami/\n\n# \u9a8c\u8bc1\u5b89\u88c5\ntsunami --help\n"})}),"\n",(0,c.jsx)(e.h4,{id:"23-gridftp-\u5b89\u88c5nas\u670d\u52a1\u5668",children:"2.3 GridFTP \u5b89\u88c5\uff08NAS\u670d\u52a1\u5668\uff09"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# Globus Toolkit \u5b89\u88c5\nsudo apt install -y globus-toolkit\n\n# \u6216\u4f7f\u7528Docker\ndocker run -d --name globus-endpoint \\\n  -p 2811:2811 \\\n  globusonline/globus-connect-server\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u4e09\u914d\u7f6e\u90e8\u7f72",children:"\u4e09\u3001\u914d\u7f6e\u90e8\u7f72"}),"\n",(0,c.jsx)(e.h4,{id:"31-ssh\u514d\u5bc6\u767b\u5f55bbcp\u7528",children:"3.1 SSH\u514d\u5bc6\u767b\u5f55\uff08bbcp\u7528\uff09"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u751f\u6210\u4e13\u7528\u5bc6\u94a5\uff08\u65e0\u52a0\u5bc6\uff09\nssh-keygen -t ed25519 -f -/.ssh/id_bbcp -N ""\nssh-keygen -t ed25519 -f -/.ssh/id_bbcp -p "" -P "" -f -/.ssh/id_bbcp\n\n# \u914d\u7f6eSSH\uff08\u7981\u7528\u52a0\u5bc6\u52a0\u901f\uff09\ncat >> -/.ssh/config <<EOF\nHost nas\n    HostName 192.168.1.100\n    User backup\n    IdentityFile -/.ssh/id_bbcp\n    PasswordAuthentication no\n    Ciphers none\n    MACs none\n    Compression no\n    BatchMode yes\n    StrictHostKeyChecking no\nEOF\n\n# \u5206\u53d1\u516c\u94a5\u5230NAS\nssh-copy-id -i -/.ssh/id_bbcp.pub backup@192.168.1.100\n\n# \u6d4b\u8bd5\u8fde\u63a5\nssh -c none backup@192.168.1.100 "echo \'OK\'"\n'})}),"\n",(0,c.jsx)(e.h4,{id:"32-bbcp-\u5b8c\u6574\u90e8\u7f72\u811a\u672c",children:"3.2 bbcp \u5b8c\u6574\u90e8\u7f72\u811a\u672c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/deploy-bbcp.sh\n# bbcp \u4e00\u952e\u90e8\u7f72\u811a\u672c\n\nset -euo pipefail\n\nSCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"\nNAS_HOST="192.168.1.100"\nNAS_USER="backup"\nNAS_PATH="/backup"\nLOCAL_USER="${USER}"\n\necho "=== bbcp \u90e8\u7f72\u811a\u672c ==="\necho "\u76ee\u6807: ${NAS_USER}@${NAS_HOST}:${NAS_PATH}"\n\n# 1. \u5b89\u88c5bbcp\necho "[1/5] \u5b89\u88c5bbcp..."\nif ! command -v bbcp &> /dev/null; then\n    sudo apt update\n    sudo apt install -y bbcp || {\n        cd /tmp\n        git clone https://github.com/ltp/bbcp.git\n        cd bbcp\n        make -j$(nproc)\n        sudo make install\n    }\nfi\necho "  bbcp\u7248\u672c: $(bbcp --version 2>&1 | head -1)"\n\n# 2. \u751f\u6210SSH\u5bc6\u94a5\necho "[2/5] \u914d\u7f6eSSH\u5bc6\u94a5..."\nmkdir -p -/.ssh\nchmod 700 -/.ssh\n\nif [ ! -f -/.ssh/id_bbcp ]; then\n    ssh-keygen -t ed25519 -f -/.ssh/id_bbcp -N "" -q\nfi\nchmod 600 -/.ssh/id_bbcp\n\n# 3. \u914d\u7f6eSSH\u5ba2\u6237\u7aef\nif ! grep -q "Ciphers none" -/.ssh/config 2>/dev/null; then\n    cat >> -/.ssh/config <<EOF\n\nHost ${NAS_HOST}\n    HostName ${NAS_HOST}\n    User ${NAS_USER}\n    IdentityFile -/.ssh/id_bbcp\n    Ciphers none\n    MACs none\n    Compression no\n    BatchMode yes\n    StrictHostKeyChecking no\nEOF\nfi\n\n# 4. \u5206\u53d1\u516c\u94a5\necho "[3/5] \u5206\u53d1\u516c\u94a5\u5230NAS..."\nssh-copy-id -i -/.ssh/id_bbcp.pub ${NAS_USER}@${NAS_HOST} || {\n    echo "  \u8b66\u544a: \u516c\u94a5\u5df2\u5b58\u5728\u6216\u5206\u53d1\u5931\u8d25"\n}\n\n# 5. \u521b\u5efa\u76ee\u5f55\u7ed3\u6784\necho "[4/5] \u521b\u5efa\u5907\u4efd\u76ee\u5f55..."\nssh ${NAS_USER}@${NAS_HOST} "mkdir -p ${NAS_PATH}/${LOCAL_USER}"\n\necho "[5/5] \u6d4b\u8bd5\u8fde\u63a5..."\nif ssh -c none ${NAS_USER}@${NAS_HOST} "echo \'OK\'" | grep -q "OK"; then\n    echo "  \u2713 \u8fde\u63a5\u6210\u529f"\nelse\n    echo "  \u2717 \u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u6216\u8ba4\u8bc1"\n    exit 1\nfi\n\necho ""\necho "=== \u90e8\u7f72\u5b8c\u6210 ==="\necho "\u53ef\u7528\u547d\u4ee4:"\necho "  bbcp -a -f -w 256M -S \'ssh -c none -x\' /data/file ${NAS_USER}@${NAS_HOST}:${NAS_PATH}/"\n'})}),"\n",(0,c.jsx)(e.h4,{id:"33-tsunami-udp-\u90e8\u7f72\u811a\u672c",children:"3.3 Tsunami UDP \u90e8\u7f72\u811a\u672c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/deploy-tsunami.sh\n# Tsunami UDP \u4e00\u952e\u90e8\u7f72\u811a\u672c\n\nset -euo pipefail\n\nNAS_HOST="192.168.1.100"\nNAS_USER="backup"\nNAS_PATH="/backup/$(whoami)"\nINSTALL_DIR="/usr/local/bin"\n\necho "=== Tsunami UDP \u90e8\u7f72\u811a\u672c ==="\n\n# 1. \u68c0\u67e5\u4f9d\u8d56\necho "[1/4] \u68c0\u67e5\u4f9d\u8d56..."\nfor cmd in make g++; do\n    if ! command -v $cmd &> /dev/null; then\n        echo "  \u5b89\u88c5 $cmd..."\n        sudo apt install -y build-essential\n        break\n    fi\ndone\n\n# 2. \u5b89\u88c5Tsunami\necho "[2/4] \u5b89\u88c5Tsunami..."\nif [ ! -f ${INSTALL_DIR}/tsunami ]; then\n    cd /tmp\n    rm -rf tsunami-udp-master\n    wget -q https://github.com/kthe/tsunami-udp/archive/refs/heads/master.zip -O tsunami.zip\n    unzip -q tsunami.zip\n    cd tsunami-udp-master\n    make -j$(nproc)\n    sudo cp tsunami ${INSTALL_DIR}/\n    sudo chmod +x ${INSTALL_DIR}/tsunami\nfi\necho "  Tsunami\u7248\u672c: $(${INSTALL_DIR}/tsunami --help 2>&1 | head -1)"\n\n# 3. \u521b\u5efa\u914d\u7f6e\necho "[3/4] \u521b\u5efa\u914d\u7f6e..."\nsudo mkdir -p /etc/tsunami\nsudo tee /etc/tsunami/tsunami.cfg > /dev/null <<EOF\n# Tsunami UDP \u914d\u7f6e\npeer_ip             ${NAS_HOST}\npeer_port           46200\nsocket_buffer_size  16777216\npacket_size         1400\nsend_buffer_size    16777216\nreceive_buffer_size 16777216\nmax_pending_packets 10000\nEOF\n\n# 4. \u8fdc\u7a0b\u90e8\u7f72\uff08\u63a5\u6536\u7aef\uff09\necho "[4/4] \u8fdc\u7a0b\u90e8\u7f72\u63a5\u6536\u7aef..."\nssh ${NAS_USER}@${NAS_HOST} "\n    mkdir -p ${NAS_PATH}\n    mkdir -p -/.tsunami\n    cat > -/.tsunami/tsunami.cfg <<CONFIG\npeer_ip             0.0.0.0\npeer_port           46200\nsocket_buffer_size  16777216\npacket_size         1400\nsend_buffer_size    16777216\nreceive_buffer_size 16777216\nmax_pending_packets 10000\nCONFIG\n"\n\necho ""\necho "=== \u90e8\u7f72\u5b8c\u6210 ==="\necho "\u4f7f\u7528\u65b9\u6cd5:"\necho "  \u63a5\u6536\u7aef: tsunami -> receive /backup/file"\necho "  \u53d1\u9001\u7aef: tsunami -> set peer ${NAS_HOST} -> send /data/file"\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u56dbsystemd-\u670d\u52a1\u914d\u7f6e",children:"\u56db\u3001Systemd \u670d\u52a1\u914d\u7f6e"}),"\n",(0,c.jsx)(e.h4,{id:"41-bbcp-\u5b9a\u65f6\u5907\u4efd\u670d\u52a1",children:"4.1 bbcp \u5b9a\u65f6\u5907\u4efd\u670d\u52a1"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-ini",children:'# -/.config/systemd/user/backup-bbcp.service\n[Unit]\nDescription=\u8bad\u7ec3\u6570\u636e\u5907\u4efd (bbcp\u6781\u901f\u7248)\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=oneshot\nExecStart=%h/scripts/backup-bbcp-fast.sh\nEnvironment="FORCE_BACKUP=false"\nEnvironment="TCP_WINDOW=256M"\nEnvironment="PARALLEL_STREAMS=8"\nStandardOutput=append:%h/.local/share/backup/logs/backup.log\nStandardError=append:%h/.local/share/backup/logs/backup.error.log\n\n[Install]\nWantedBy=default.target\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-ini",children:"# -/.config/systemd/user/backup-bbcp.timer\n[Unit]\nDescription=\u6bcf\u592922:00\u81ea\u52a8\u5907\u4efd\u8bad\u7ec3\u6570\u636e (bbcp\u6781\u901f\u7248)\n\n[Timer]\nOnCalendar=*-*-* 22:00:00\nPersistent=true\nRandomizedDelaySec=5min\nAccuracySec=1min\n\n[Install]\nWantedBy=timers.target\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u542f\u7528\u670d\u52a1\nsystemctl --user daemon-reload\nsystemctl --user enable backup-bbcp.timer\nsystemctl --user start backup-bbcp.timer\n\n# \u67e5\u770b\u72b6\u6001\nsystemctl --user list-timers\n"})}),"\n",(0,c.jsx)(e.h4,{id:"42-tsunami-udp-\u63a5\u6536\u7aef\u5e38\u9a7b\u670d\u52a1",children:"4.2 Tsunami UDP \u63a5\u6536\u7aef\u5e38\u9a7b\u670d\u52a1"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-ini",children:"# /etc/systemd/system/tsunami-receive.service\n[Unit]\nDescription=Tsunami UDP \u63a5\u6536\u670d\u52a1\nAfter=network-online.target\n\n[Service]\nType=simple\nUser=backup\nExecStart=/usr/local/bin/tsunami receive /backup/%u\nStandardOutput=journal\nStandardError=journal\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u90e8\u7f72\u63a5\u6536\u7aef\u670d\u52a1\nsudo cp tsunami-receive.service /etc/systemd/system/\nsudo systemctl daemon-reload\nsudo systemctl enable tsunami-receive\nsudo systemctl start tsunami-receive\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u4e94\u5907\u4efd\u811a\u672c",children:"\u4e94\u3001\u5907\u4efd\u811a\u672c"}),"\n",(0,c.jsx)(e.h4,{id:"51-bbcp-\u5b8c\u6574\u5907\u4efd\u811a\u672c",children:"5.1 bbcp \u5b8c\u6574\u5907\u4efd\u811a\u672c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/backup-bbcp.sh\n# \u8bad\u7ec3\u6570\u636e\u5907\u4efd - bbcp\u6781\u901f\u7248\n\nset -euo pipefail\n\n# \u914d\u7f6e\nNAS_HOST="${NAS_HOST:-192.168.1.100}"\nNAS_USER="${NAS_USER:-backup}"\nNAS_PATH="${NAS_PATH:-/backup}"\nTCP_WINDOW="${TCP_WINDOW:-256M}"\nPARALLEL_STREAMS="${PARALLEL_STREAMS:-8}"\nSOURCE_PATHS=(\n    "/data/training"\n    "/data/models"\n    "/data/experiments"\n)\nLOG_DIR="${HOME}/.local/share/backup/logs"\nLOG_FILE="${LOG_DIR}/bbcp_$(date +%Y%m%d).log"\n\nlog() {\n    echo "[$(date \'+%Y-%m-%d %H:%M:%S\')] [bbcp] $*" | tee -a "${LOG_FILE}"\n}\n\ncheck_nas() {\n    if ! ssh -c none -o BatchMode=yes ${NAS_USER}@${NAS_HOST} "test -w ${NAS_PATH}" 2>/dev/null; then\n        log "\u9519\u8bef: \u65e0\u6cd5\u8bbf\u95eeNAS ${NAS_USER}@${NAS_HOST}:${NAS_PATH}"\n        return 1\n    fi\n}\n\nrun_backup() {\n    local src="$1"\n    local dst="${NAS_USER}@${NAS_HOST}:${NAS_PATH}$(dirname ${src})"\n    \n    if [ ! -d "${src}" ]; then\n        log "\u8df3\u8fc7: ${src} \u4e0d\u5b58\u5728"\n        return 0\n    fi\n    \n    local file_count=$(find "${src}" -type f | wc -l)\n    local total_size=$(du -sb "${src}" | cut -f1)\n    \n    log "\u5f00\u59cb\u5907\u4efd: ${src}"\n    log "  \u6587\u4ef6\u6570: ${file_count}"\n    log "  \u603b\u5927\u5c0f: $(numfmt --to=iec ${total_size})"\n    \n    # bbcp\u6781\u901f\u4f20\u8f93\n    bbcp -a -f -w "${TCP_WINDOW}" \\\n        -S "ssh -c none -x -o Compression=no -o BatchMode=yes" \\\n        --ignore-permissions \\\n        --verbose \\\n        "${src}/" \\\n        "${dst}/" \\\n        2>&1 | while read line; do\n            log "  $line"\n        done\n    \n    if [ ${PIPESTATUS[0]} -eq 0 ]; then\n        log "\u5b8c\u6210: ${src}"\n        log "\u5220\u9664\u6e90\u6587\u4ef6..."\n        find "${src}" -type f -delete 2>/dev/null || true\n    else\n        log "\u9519\u8bef: ${src}"\n        return 1\n    fi\n}\n\nmain() {\n    mkdir -p "${LOG_DIR}"\n    log "========== bbcp\u5907\u4efd\u5f00\u59cb =========="\n    log "\u76ee\u6807: ${NAS_USER}@${NAS_HOST}:${NAS_PATH}"\n    log "TCP\u7a97\u53e3: ${TCP_WINDOW}, \u5e76\u884c\u6d41: ${PARALLEL_STREAMS}"\n    \n    check_nas || exit 1\n    \n    for path in "${SOURCE_PATHS[@]}"; do\n        run_backup "${path}"\n    done\n    \n    log "========== bbcp\u5907\u4efd\u5b8c\u6210 =========="\n    \n    # \u8f93\u51fa\u7edf\u8ba1\n    ssh ${NAS_USER}@${NAS_HOST} "du -sh ${NAS_PATH}/*" | while read size dir; do\n        log "  ${size} ${dir}"\n    done\n}\n\nmain "$@"\n'})}),"\n",(0,c.jsx)(e.h4,{id:"52-tsunami-udp-\u5907\u4efd\u811a\u672c",children:"5.2 Tsunami UDP \u5907\u4efd\u811a\u672c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/backup-tsunami.sh\n# \u8bad\u7ec3\u6570\u636e\u5907\u4efd - Tsunami UDP\u6781\u901f\u7248\n\nset -euo pipefail\n\n# \u914d\u7f6e\nNAS_HOST="${NAS_HOST:-192.168.1.100}"\nNAS_PORT="${NAS_PORT:-46200}"\nNAS_PATH="${NAS_PATH:-/backup}"\nSOURCE_PATHS=(\n    "/data/training"\n    "/data/models"\n)\nLOG_DIR="${HOME}/.local/share/backup/logs"\nLOG_FILE="${LOG_DIR}/tsunami_$(date +%Y%m%d).log"\n\nlog() {\n    echo "[$(date \'+%Y-%m-%d %H:%M:%S\')] [tsunami] $*" | tee -a "${LOG_FILE}"\n}\n\nrun_backup() {\n    local src="$1"\n    \n    if [ ! -d "${src}" ]; then\n        log "\u8df3\u8fc7: ${src} \u4e0d\u5b58\u5728"\n        return 0\n    fi\n    \n    log "\u5f00\u59cb\u5907\u4efd: ${src} -> ${NAS_HOST}:${NAS_PATH}$(dirname ${src})"\n    \n    # Tsunami\u4ea4\u4e92\u5f0f\u547d\u4ee4\n    {\n        echo "set peer ${NAS_HOST}"\n        echo "set port ${NAS_PORT}"\n        echo "set buffer 16777216"\n        echo "send ${src}/*"\n        echo "quit"\n    } | timeout 86400 tsunami 2>&1 | while read line; do\n        log "  $line"\n    done\n    \n    # \u5220\u9664\u6e90\u6587\u4ef6\uff08\u786e\u8ba4\u4f20\u8f93\u6210\u529f\uff09\n    if [ ${PIPESTATUS[0]} -eq 0 ]; then\n        log "\u5b8c\u6210: ${src}"\n        log "\u5220\u9664\u6e90\u6587\u4ef6..."\n        find "${src}" -type f -delete 2>/dev/null || true\n    else\n        log "\u9519\u8bef: ${src}"\n    fi\n}\n\nmain() {\n    mkdir -p "${LOG_DIR}"\n    log "========== Tsunami UDP\u5907\u4efd\u5f00\u59cb =========="\n    log "\u76ee\u6807: ${NAS_HOST}:${NAS_PORT}"\n    \n    for path in "${SOURCE_PATHS[@]}"; do\n        run_backup "${path}"\n    done\n    \n    log "========== Tsunami UDP\u5907\u4efd\u5b8c\u6210 =========="\n}\n\nmain "$@"\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u516d\u76d1\u63a7\u4e0e\u544a\u8b66",children:"\u516d\u3001\u76d1\u63a7\u4e0e\u544a\u8b66"}),"\n",(0,c.jsx)(e.h4,{id:"61-\u4f20\u8f93\u76d1\u63a7\u811a\u672c",children:"6.1 \u4f20\u8f93\u76d1\u63a7\u811a\u672c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/monitor-transfer.sh\n# \u4f20\u8f93\u76d1\u63a7\u4e0e\u544a\u8b66\n\nLOG_DIR="${HOME}/.local/share/backup/logs"\nALERT_EMAIL="admin@stars-labs.com"\nNAS_HOST="192.168.1.100"\n\ncheck_recent_backup() {\n    local last_log=$(ls -t ${LOG_DIR}/bbcp_*.log 2>/dev/null | head -1)\n    \n    if [ -z "$last_log" ]; then\n        echo "\u65e0\u5907\u4efd\u8bb0\u5f55"\n        return 1\n    fi\n    \n    local last_time=$(stat -c %Y "$last_log")\n    local now=$(date +%s)\n    local diff=$((now - last_time))\n    \n    if [ $diff -gt 86400 ]; then\n        echo "\u8b66\u544a: \u8d85\u8fc724\u5c0f\u65f6\u65e0\u5907\u4efd (${diff}s)"\n        return 1\n    fi\n    \n    echo "\u6b63\u5e38: \u6700\u540e\u5907\u4efd ${diff}s \u524d"\n    return 0\n}\n\ncheck_nas_space() {\n    local space=$(ssh backup@${NAS_HOST} "df -h ${NAS_PATH} | tail -1" 2>/dev/null)\n    echo "$space"\n}\n\ncheck_active_transfer() {\n    local transfer=$(ps aux | grep -E "(bbcp|tsunami)" | grep -v grep | wc -l)\n    if [ $transfer -gt 0 ]; then\n        echo "\u8fd0\u884c\u4e2d: $transfer \u4e2a\u4f20\u8f93\u8fdb\u7a0b"\n    else\n        echo "\u7a7a\u95f2"\n    fi\n}\n\nmain() {\n    echo "=== \u5907\u4efd\u72b6\u6001\u76d1\u63a7 ==="\n    echo "\u65f6\u95f4: $(date)"\n    echo ""\n    \n    echo "1. \u5907\u4efd\u72b6\u6001:"\n    check_recent_backup\n    echo ""\n    \n    echo "2. NAS\u7a7a\u95f4:"\n    check_nas_space\n    echo ""\n    \n    echo "3. \u4f20\u8f93\u8fdb\u7a0b:"\n    check_active_transfer\n    echo ""\n    \n    echo "4. \u6700\u8fd1\u65e5\u5fd7:"\n    ls -t ${LOG_DIR}/bbcp_*.log 2>/dev/null | head -3 | while read f; do\n        echo "  $(basename $f): $(tail -1 $f 2>/dev/null)"\n    done\n}\n\nmain "$@"\n'})}),"\n",(0,c.jsx)(e.h4,{id:"62-prometheus-\u76d1\u63a7\u6307\u6807",children:"6.2 Prometheus \u76d1\u63a7\u6307\u6807"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"#!/bin/bash\n# -/scripts/backup-metrics.sh\n# \u5bfc\u51faPrometheus\u6307\u6807\n\nLOG_DIR=\"${HOME}/.local/share/backup/logs\"\n\n# \u6700\u540e\u5907\u4efd\u65f6\u95f4\nLAST_BACKUP=$(ls -t ${LOG_DIR}/bbcp_*.log 2>/dev/null | head -1 | xargs stat -c %Y 2>/dev/null || echo 0)\nNOW=$(date +%s)\nAGE=$((NOW - LAST_BACKUP))\n\ncat <<EOF\n# HELP backup_last_success_timestamp_seconds Unixtime of last successful backup\n# TYPE backup_last_success_timestamp_seconds gauge\nbackup_last_success_timestamp_seconds $LAST_BACKUP\n\n# HELP backup_age_seconds Seconds since last backup\n# TYPE backup_age_seconds gauge\nbackup_age_seconds $AGE\n\n# HELP backup_last_transfer_speed_bytes_per_second\n# TYPE backup_last_transfer_speed_bytes_per_second gauge\nbackup_last_transfer_speed_bytes_per_second $(tail -50 ${LOG_DIR}/bbcp_*.log 2>/dev/null | grep -oP '\\d+\\s+bytes/s' | head -1 | awk '{print $1}' || echo 0)\n\n# HELP backup_errors_total Total number of backup errors\n# TYPE backup_errors_total counter\nbackup_errors_total $(grep -c \"\u9519\u8bef\" ${LOG_DIR}/bbcp_*.log 2>/dev/null || echo 0)\nEOF\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u4e03\u6545\u969c\u6392\u67e5",children:"\u4e03\u3001\u6545\u969c\u6392\u67e5"}),"\n",(0,c.jsx)(e.h4,{id:"71-\u5e38\u89c1\u95ee\u9898",children:"7.1 \u5e38\u89c1\u95ee\u9898"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# 1. \u8fde\u63a5\u5931\u8d25\nssh -vvv -c none backup@192.168.1.100\n\n# 2. \u901f\u5ea6\u4e0d\u8fbe\u6807\n# \u68c0\u67e5\u7f51\u7edc\niperf3 -c 192.168.1.100 -P 4 -t 30\n\n# \u68c0\u67e5CPU\ntop -bn1 | grep -E "(bbcp|ssh|encryption)"\n\n# \u68c0\u67e5\u78c1\u76d8IO\niotop -b -n 3\n\n# 3. TCP\u7a97\u53e3\u8fc7\u5c0f\n# \u68c0\u67e5\u7cfb\u7edf\u914d\u7f6e\nsysctl net.ipv4.tcp_rmem\nsysctl net.core.rmem_max\n\n# 4. MTU\u95ee\u9898\nping -M do -s 8972 192.168.1.100\n\n# 5. \u6587\u4ef6\u6743\u9650\nls -la /data/training/\nid\n'})}),"\n",(0,c.jsx)(e.h4,{id:"72-\u6027\u80fd\u8c03\u4f18\u68c0\u67e5\u6e05\u5355",children:"7.2 \u6027\u80fd\u8c03\u4f18\u68c0\u67e5\u6e05\u5355"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/check-tuning.sh\n\necho "=== \u6027\u80fd\u8c03\u4f18\u68c0\u67e5 ==="\n\n# 1. \u7f51\u5361MTU\necho -n "MTU: "\nip link show eth0 | grep -oP \'mtu \\K\\d+\'\n\n# 2. TCP\u7f13\u51b2\u533a\necho -n "TCP rmem_max: "\nsysctl net.core.rmem_max 2>/dev/null | awk \'{print $3}\'\n\n# 3. \u6253\u5f00\u6587\u4ef6\u6570\necho -n "ulimit -n: "\nulimit -n\n\n# 4. bbcp\u7248\u672c\nbbcp --version 2>&1 | head -1\n\n# 5. SSH\u52a0\u5bc6\necho -n "SSH Ciphers: "\nssh -c none -o BatchMode=yes localhost "echo OK" 2>&1 | grep -q "OK" && echo "none\u53ef\u7528" || echo "none\u4e0d\u53ef\u7528"\n\n# 6. \u7f51\u7edc\u5e26\u5bbd\necho "\u7f51\u7edc\u5e26\u5bbd\u6d4b\u8bd5:"\niperf3 -c 192.168.1.100 -t 5 -J | jq \'.end.sum_sent.bits_per_second / 1e9\'\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u516b\u90e8\u7f72\u68c0\u67e5\u6e05\u5355",children:"\u516b\u3001\u90e8\u7f72\u68c0\u67e5\u6e05\u5355"}),"\n",(0,c.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u7f51\u7edc\u5e26\u5bbd\u6d4b\u8bd5\u901a\u8fc7 (>= 9Gbps)"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u4e22\u5305\u7387 < 0.01%"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","MTU \u8bbe\u7f6e\u4e3a 9000"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u7cfb\u7edf\u53c2\u6570\u5df2\u4f18\u5316 (",(0,c.jsx)(e.code,{children:"net.core.rmem_max >= 536870912"}),")"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","bbcp \u5b89\u88c5\u5b8c\u6210\u5e76\u9a8c\u8bc1"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Tsunami UDP \u5b89\u88c5\u5b8c\u6210\uff08\u53ef\u9009\uff09"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","SSH \u514d\u5bc6\u767b\u5f55\u914d\u7f6e\u5b8c\u6210"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","NAS \u76ee\u5f55\u6743\u9650\u914d\u7f6e\u6b63\u786e"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u5907\u4efd\u811a\u672c\u6d4b\u8bd5\u901a\u8fc7"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Systemd Timer \u542f\u7528"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u76d1\u63a7\u811a\u672c\u914d\u7f6e\u5b8c\u6210"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u9996\u6b21\u5b8c\u6574\u5907\u4efd\u6210\u529f"]}),"\n",(0,c.jsxs)(e.li,{className:"task-list-item",children:[(0,c.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u6062\u590d\u6d4b\u8bd5\u901a\u8fc7"]}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u4e5d\u56de\u6eda\u65b9\u6848",children:"\u4e5d\u3001\u56de\u6eda\u65b9\u6848"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# -/scripts/rollback-bbcp.sh\n\necho "=== bbcp \u56de\u6eda\u5230 rclone ==="\n\n# \u5207\u6362\u5230rclone\nsed -i \'s/bbcp/rclone/g\' -/scripts/backup.sh\nsed -i \'s/--transfers.*/--transfers 8 \\\\/g\' -/scripts/backup.sh\n\n# \u91cd\u542f\u670d\u52a1\nsystemctl --user stop backup-bbcp.timer\nsystemctl --user disable backup-bbcp.timer\n\nsystemctl --user enable backup-rclone.timer\nsystemctl --user start backup-rclone.timer\n\necho "\u5df2\u5207\u6362\u5230rclone\u5907\u4efd"\necho "\u67e5\u770b\u72b6\u6001: systemctl --user list-timers"\n'})})]})}function x(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(a,{...n})}):a(n)}}}]);